<!DOCTYPE html>
<html lang="zh"><head><title>网络层</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Comic_Sans_MS:wght@400;700&amp;family=Comic_Sans_MS:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="🪴 Quartz 4.0"/><meta property="og:title" content="网络层"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="网络层"/><meta name="twitter:description" content="网络层概述 网络层的主要目的在任意结点间进行数据报不可靠传输。 网络层的主要任务就是将分组从源主机经过多个网络和多段链路传输到目的主机，可以将该任务划分为分组转发和路由选择两种重要的功能。 冲突域 冲突域是指能产生冲突的所有设备的集合，这些结点之间存在介质争用的现象。 在 OSI 参考模型中，冲突域被视为第 1 层的概念，像集线器、中继器等简单无脑复制转发信号的第 ..."/><meta property="og:description" content="网络层概述 网络层的主要目的在任意结点间进行数据报不可靠传输。 网络层的主要任务就是将分组从源主机经过多个网络和多段链路传输到目的主机，可以将该任务划分为分组转发和路由选择两种重要的功能。 冲突域 冲突域是指能产生冲突的所有设备的集合，这些结点之间存在介质争用的现象。 在 OSI 参考模型中，冲突域被视为第 1 层的概念，像集线器、中继器等简单无脑复制转发信号的第 ..."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="网络层概述 网络层的主要目的在任意结点间进行数据报不可靠传输。 网络层的主要任务就是将分组从源主机经过多个网络和多段链路传输到目的主机，可以将该任务划分为分组转发和路由选择两种重要的功能。 冲突域 冲突域是指能产生冲突的所有设备的集合，这些结点之间存在介质争用的现象。 在 OSI 参考模型中，冲突域被视为第 1 层的概念，像集线器、中继器等简单无脑复制转发信号的第 ..."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:url" content="https://kisgp.cn/static/og-image.png"/><meta name="twitter:image" content="https://kisgp.cn/static/og-image.png"/><meta property="og:image" content="https://kisgp.cn/static/og-image.png"/><meta property="twitter:domain" content="kisgp.cn"/><meta property="og:url" content="https://kisgp.cn/计算机基础/计算机网络/4_网络层"/><meta property="twitter:url" content="https://kisgp.cn/计算机基础/计算机网络/4_网络层"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="网络层概述 网络层的主要目的在任意结点间进行数据报不可靠传输。 网络层的主要任务就是将分组从源主机经过多个网络和多段链路传输到目的主机，可以将该任务划分为分组转发和路由选择两种重要的功能。 冲突域 冲突域是指能产生冲突的所有设备的集合，这些结点之间存在介质争用的现象。 在 OSI 参考模型中，冲突域被视为第 1 层的概念，像集线器、中继器等简单无脑复制转发信号的第 ..."/><meta name="generator" content="Quartz"/><link href="../../static/font/font-style.css" rel="stylesheet" type="text/css" spa-preserve/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="计算机基础/计算机网络/4_网络层"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../..">🪴 Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>搜索</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="搜索些什么" placeholder="搜索些什么"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="暗色模式"><title>暗色模式</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="亮色模式"><title>亮色模式</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;编程语言&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;编程语言/Java&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;编程语言/JavaScript&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;编程语言/Rust&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;编程语言/Rust/Rust认识&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;服务器&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;计算机基础&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;计算机基础/编译原理&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;计算机基础/计算机操作系统&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;计算机基础/计算机网络&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;计算机基础/计算机组成原理&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;计算机基础/软件测试&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;计算机基础/数据结构和算法&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;计算机基础/数据库系统概论&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;浏览器&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;浏览器/react&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;浏览器/react/react学习&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;浏览器/rspress&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;数据库&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;阅读&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;阅读/未完成&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Git&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Markdown&quot;,&quot;collapsed&quot;:true}]" aria-controls="explorer-content" aria-expanded="false"><h2>探索</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="编程语言"><button class="folder-button"><span class="folder-title">编程语言</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="编程语言"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="编程语言/Java"><button class="folder-button"><span class="folder-title">Java</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="编程语言/Java"><li><a href="../../编程语言/Java/JavaWeb复习" data-for="编程语言/Java/JavaWeb复习">JavaWeb复习</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="编程语言/JavaScript"><button class="folder-button"><span class="folder-title">JavaScript</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="编程语言/JavaScript"><li><a href="../../编程语言/JavaScript/JS" data-for="编程语言/JavaScript/JS">JS</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="编程语言/Rust"><button class="folder-button"><span class="folder-title">Rust</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="编程语言/Rust"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="编程语言/Rust/Rust认识"><button class="folder-button"><span class="folder-title">Rust认识</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="编程语言/Rust/Rust认识"><li><a href="../../编程语言/Rust/Rust认识/3_变量" data-for="编程语言/Rust/Rust认识/3_变量">3_变量</a></li><li><a href="../../编程语言/Rust/Rust认识/4_类型" data-for="编程语言/Rust/Rust认识/4_类型">4_类型</a></li><li><a href="../../编程语言/Rust/Rust认识/2_cargo使用" data-for="编程语言/Rust/Rust认识/2_cargo使用">Cargo 使用</a></li><li><a href="../../编程语言/Rust/Rust认识/1_环境配置" data-for="编程语言/Rust/Rust认识/1_环境配置">Rust 环境配置</a></li></ul></div></li></ul></div></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="服务器"><button class="folder-button"><span class="folder-title">服务器</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="服务器"><li><a href="../../服务器/使用-Cloudflare-Workers-优化-Github-文件国内访问" data-for="服务器/使用-Cloudflare-Workers-优化-Github-文件国内访问">使用 Cloudflare Workers 优化 Github 文件国内访问速度</a></li><li><a href="../../服务器/域名注册" data-for="服务器/域名注册">域名注册</a></li><li><a href="../../服务器/MinIO-使用" data-for="服务器/MinIO-使用">MinIO 使用</a></li><li><a href="../../服务器/OSS-对象存储" data-for="服务器/OSS-对象存储">OSS 对象存储</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="计算机基础"><button class="folder-button"><span class="folder-title">计算机基础</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="计算机基础"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="计算机基础/编译原理"><button class="folder-button"><span class="folder-title">编译原理</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="计算机基础/编译原理"><li><a href="../../计算机基础/编译原理/3_词法分析" data-for="计算机基础/编译原理/3_词法分析">词法分析</a></li><li><a href="../../计算机基础/编译原理/1_开始" data-for="计算机基础/编译原理/1_开始">开始</a></li><li><a href="../../计算机基础/编译原理/2_引论" data-for="计算机基础/编译原理/2_引论">引论</a></li><li><a href="../../计算机基础/编译原理/4_语法分析" data-for="计算机基础/编译原理/4_语法分析">语法分析</a></li><li><a href="../../计算机基础/编译原理/5_语义分析与中间代码生成器" data-for="计算机基础/编译原理/5_语义分析与中间代码生成器">语义分析与中间代码生成器</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="计算机基础/计算机操作系统"><button class="folder-button"><span class="folder-title">计算机操作系统</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="计算机基础/计算机操作系统"><li><a href="../../计算机基础/计算机操作系统/1_操作系统概述" data-for="计算机基础/计算机操作系统/1_操作系统概述">操作系统概述</a></li><li><a href="../../计算机基础/计算机操作系统/2_进程与线程" data-for="计算机基础/计算机操作系统/2_进程与线程">进程与线程</a></li><li><a href="../../计算机基础/计算机操作系统/3_内存管理" data-for="计算机基础/计算机操作系统/3_内存管理">内存管理</a></li><li><a href="../../计算机基础/计算机操作系统/4_文件管理" data-for="计算机基础/计算机操作系统/4_文件管理">文件管理</a></li><li><a href="../../计算机基础/计算机操作系统/5_输入输出管理" data-for="计算机基础/计算机操作系统/5_输入输出管理">I/O管理</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="计算机基础/计算机网络"><button class="folder-button"><span class="folder-title">计算机网络</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="计算机基础/计算机网络"><li><a href="../../计算机基础/计算机网络/5_传输层" data-for="计算机基础/计算机网络/5_传输层">传输层</a></li><li><a href="../../计算机基础/计算机网络/1_计算机网络体系结构" data-for="计算机基础/计算机网络/1_计算机网络体系结构">计算机网络体系结构</a></li><li><a href="../../计算机基础/计算机网络/3_数据链路层" data-for="计算机基础/计算机网络/3_数据链路层">数据链路层</a></li><li><a href="../../计算机基础/计算机网络/4_网络层" data-for="计算机基础/计算机网络/4_网络层">网络层</a></li><li><a href="../../计算机基础/计算机网络/2_物理层" data-for="计算机基础/计算机网络/2_物理层">物理层</a></li><li><a href="../../计算机基础/计算机网络/6_应用层" data-for="计算机基础/计算机网络/6_应用层">应用层</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="计算机基础/计算机组成原理"><button class="folder-button"><span class="folder-title">计算机组成原理</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="计算机基础/计算机组成原理"><li><a href="../../计算机基础/计算机组成原理/3_存储系统" data-for="计算机基础/计算机组成原理/3_存储系统">存储系统</a></li><li><a href="../../计算机基础/计算机组成原理/1_计算机系统概述" data-for="计算机基础/计算机组成原理/1_计算机系统概述">计算机组成原理</a></li><li><a href="../../计算机基础/计算机组成原理/2_数据的表示和运算" data-for="计算机基础/计算机组成原理/2_数据的表示和运算">数据的表示和运算</a></li><li><a href="../../计算机基础/计算机组成原理/4_指令系统" data-for="计算机基础/计算机组成原理/4_指令系统">指令系统</a></li><li><a href="../../计算机基础/计算机组成原理/5_中央处理器" data-for="计算机基础/计算机组成原理/5_中央处理器">中央处理器</a></li><li><a href="../../计算机基础/计算机组成原理/6_总线" data-for="计算机基础/计算机组成原理/6_总线">总线</a></li><li><a href="../../计算机基础/计算机组成原理/7_IO系统" data-for="计算机基础/计算机组成原理/7_IO系统">I/O 系统</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="计算机基础/软件测试"><button class="folder-button"><span class="folder-title">软件测试</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="计算机基础/软件测试"><li><a href="../../计算机基础/软件测试/1_软件测试技术复习" data-for="计算机基础/软件测试/1_软件测试技术复习">软件测试技术复习</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="计算机基础/数据结构和算法"><button class="folder-button"><span class="folder-title">数据结构和算法</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="计算机基础/数据结构和算法"><li><a href="../../计算机基础/数据结构和算法/8_查找" data-for="计算机基础/数据结构和算法/8_查找">查找</a></li><li><a href="../../计算机基础/数据结构和算法/5_串" data-for="计算机基础/数据结构和算法/5_串">串</a></li><li><a href="../../计算机基础/数据结构和算法/9_排序" data-for="计算机基础/数据结构和算法/9_排序">排序</a></li><li><a href="../../计算机基础/数据结构和算法/6_树" data-for="计算机基础/数据结构和算法/6_树">树</a></li><li><a href="../../计算机基础/数据结构和算法/1_数据结构基本概念" data-for="计算机基础/数据结构和算法/1_数据结构基本概念">数据结构的基本概念</a></li><li><a href="../../计算机基础/数据结构和算法/2_算法基本概念" data-for="计算机基础/数据结构和算法/2_算法基本概念">算法基本概念</a></li><li><a href="../../计算机基础/数据结构和算法/7_图" data-for="计算机基础/数据结构和算法/7_图">图</a></li><li><a href="../../计算机基础/数据结构和算法/3_线性表" data-for="计算机基础/数据结构和算法/3_线性表">线性表</a></li><li><a href="../../计算机基础/数据结构和算法/4_栈和队列" data-for="计算机基础/数据结构和算法/4_栈和队列">栈和队列</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="计算机基础/数据库系统概论"><button class="folder-button"><span class="folder-title">数据库系统概论</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="计算机基础/数据库系统概论"><li><a href="../../计算机基础/数据库系统概论/11_并发控制" data-for="计算机基础/数据库系统概论/11_并发控制">并发控制</a></li><li><a href="../../计算机基础/数据库系统概论/9_关系查询处理和查询优化" data-for="计算机基础/数据库系统概论/9_关系查询处理和查询优化">关系查询处理和查询优化</a></li><li><a href="../../计算机基础/数据库系统概论/2_关系数据库" data-for="计算机基础/数据库系统概论/2_关系数据库">关系数据库</a></li><li><a href="../../计算机基础/数据库系统概论/6_关系数据理论" data-for="计算机基础/数据库系统概论/6_关系数据理论">关系数据理论</a></li><li><a href="../../计算机基础/数据库系统概论/4_数据库安全性" data-for="计算机基础/数据库系统概论/4_数据库安全性">数据库安全性</a></li><li><a href="../../计算机基础/数据库系统概论/8_数据库编程" data-for="计算机基础/数据库系统概论/8_数据库编程">数据库编程</a></li><li><a href="../../计算机基础/数据库系统概论/10_数据库恢复技术" data-for="计算机基础/数据库系统概论/10_数据库恢复技术">数据库恢复技术</a></li><li><a href="../../计算机基础/数据库系统概论/7_数据库设计" data-for="计算机基础/数据库系统概论/7_数据库设计">数据库设计</a></li><li><a href="../../计算机基础/数据库系统概论/5_数据库完整性" data-for="计算机基础/数据库系统概论/5_数据库完整性">数据库完整性</a></li><li><a href="../../计算机基础/数据库系统概论/1_绪论" data-for="计算机基础/数据库系统概论/1_绪论">绪论</a></li><li><a href="../../计算机基础/数据库系统概论/3_SQL" data-for="计算机基础/数据库系统概论/3_SQL">SQL</a></li></ul></div></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="浏览器"><button class="folder-button"><span class="folder-title">浏览器</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="浏览器"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="浏览器/react"><button class="folder-button"><span class="folder-title">react</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="浏览器/react"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="浏览器/react/react学习"><button class="folder-button"><span class="folder-title">react学习</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="浏览器/react/react学习"><li><a href="../../浏览器/react/react学习/9_Hook" data-for="浏览器/react/react学习/9_Hook">Hook的使用</a></li><li><a href="../../浏览器/react/react学习/2_jsx基本语法" data-for="浏览器/react/react学习/2_jsx基本语法">jsx基本语法</a></li><li><a href="../../浏览器/react/react学习/1_react初体验" data-for="浏览器/react/react学习/1_react初体验">react初体验</a></li><li><a href="../../浏览器/react/react学习/6_react动画" data-for="浏览器/react/react学习/6_react动画">react动画</a></li><li><a href="../../浏览器/react/react学习/3_react脚手架解析" data-for="浏览器/react/react学习/3_react脚手架解析">react脚手架解析</a></li><li><a href="../../浏览器/react/react学习/4_react性能优化" data-for="浏览器/react/react学习/4_react性能优化">react性能优化</a></li><li><a href="../../浏览器/react/react学习/5_react组件化开发" data-for="浏览器/react/react学习/5_react组件化开发">react组件化开发</a></li><li><a href="../../浏览器/react/react学习/7_Redux的使用" data-for="浏览器/react/react学习/7_Redux的使用">Redux的使用</a></li><li><a href="../../浏览器/react/react学习/8_Router的使用" data-for="浏览器/react/react学习/8_Router的使用">Router的使用</a></li></ul></div></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="浏览器/rspress"><button class="folder-button"><span class="folder-title">rspress</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="浏览器/rspress"><li><a href="../../浏览器/rspress/LaTeX无法使用$$语法" data-for="浏览器/rspress/LaTeX无法使用$$语法">LaTeX无法使用$$语法</a></li><li><a href="../../浏览器/rspress/自动生成侧边栏" data-for="浏览器/rspress/自动生成侧边栏">rspress 自动生成侧边栏</a></li></ul></div></li><li><a href="../../浏览器/CORS错误" data-for="浏览器/CORS错误">CORS错误</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="数据库"><button class="folder-button"><span class="folder-title">数据库</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="数据库"><li><a href="../../数据库/MongoDB-使用" data-for="数据库/MongoDB-使用">MongoDB 使用</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="阅读"><button class="folder-button"><span class="folder-title">阅读</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="阅读"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="阅读/未完成"><button class="folder-button"><span class="folder-title">未完成</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="阅读/未完成"><li><a href="../../阅读/未完成/解构现代化：温铁军演讲录" data-for="阅读/未完成/解构现代化：温铁军演讲录">解构现代化：温铁军演讲录</a></li><li><a href="../../阅读/未完成/金瓶梅词话（上下）" data-for="阅读/未完成/金瓶梅词话（上下）">金瓶梅词话（上下）</a></li><li><a href="../../阅读/未完成/思想的力量（第9版）" data-for="阅读/未完成/思想的力量（第9版）">思想的力量（第9版）</a></li><li><a href="../../阅读/未完成/乡土中国-生育制度-乡土重建" data-for="阅读/未完成/乡土中国-生育制度-乡土重建">乡土中国 生育制度 乡土重建</a></li><li><a href="../../阅读/未完成/制造消费者：消费主义全球史" data-for="阅读/未完成/制造消费者：消费主义全球史">制造消费者：消费主义全球史</a></li></ul></div></li><li><a href="../../阅读/大清为何轰然倒塌" data-for="阅读/大清为何轰然倒塌">大清为何轰然倒塌</a></li><li><a href="../../阅读/叫魂：1768年中国妖术大恐慌" data-for="阅读/叫魂：1768年中国妖术大恐慌">叫魂：1768年中国妖术大恐慌</a></li><li><a href="../../阅读/菊与刀" data-for="阅读/菊与刀">菊与刀</a></li><li><a href="../../阅读/论语" data-for="阅读/论语">论语</a></li><li><a href="../../阅读/毛泽东选集" data-for="阅读/毛泽东选集">毛泽东选集</a></li><li><a href="../../阅读/人民公开课：中国共产党与国家治理体系和治理能力现代化" data-for="阅读/人民公开课：中国共产党与国家治理体系和治理能力现代化">人民公开课：中国共产党与国家治理体系和治理能力现代化</a></li><li><a href="../../阅读/盛唐到底盛在哪儿" data-for="阅读/盛唐到底盛在哪儿">盛唐到底盛在哪儿</a></li><li><a href="../../阅读/伊豆的舞女" data-for="阅读/伊豆的舞女">伊豆的舞女</a></li><li><a href="../../阅读/以利为利：财政关系与地方政府行为" data-for="阅读/以利为利：财政关系与地方政府行为">以利为利：财政关系与地方政府行为</a></li><li><a href="../../阅读/哲学导论讲记" data-for="阅读/哲学导论讲记">哲学导论讲记</a></li><li><a href="../../阅读/治大国若烹小鲜：基层治理与世道人心" data-for="阅读/治大国若烹小鲜：基层治理与世道人心">治大国若烹小鲜：基层治理与世道人心</a></li><li><a href="../../阅读/置身事内：中国政府与经济发展" data-for="阅读/置身事内：中国政府与经济发展">置身事内：中国政府与经济发展</a></li><li><a href="../../阅读/中国是部金融史" data-for="阅读/中国是部金融史">中国是部金融史</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Git"><button class="folder-button"><span class="folder-title">Git</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Git"><li><a href="../../Git/删除分支" data-for="Git/删除分支">删除分支</a></li><li><a href="../../Git/文件.gitkeep是什么" data-for="Git/文件.gitkeep是什么">文件.gitkeep是什么</a></li></ul></div></li><li><div class="folder-outer "><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Markdown"><button class="folder-button"><span class="folder-title">Markdown</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Markdown"><li><a href="../../Markdown/Callouts-标注" data-for="Markdown/Callouts-标注">Callouts 标注</a></li><li><a href="../../Markdown/Obsidian-教程" data-for="Markdown/Obsidian-教程">Obsidian 教程</a></li><li><a href="../../Markdown/Typora-自定义-Callouts-样式" data-for="Markdown/Typora-自定义-Callouts-样式">Typora 自定义 Callouts</a></li><li><a href="../../Markdown/Typora-自定义字体" data-for="Markdown/Typora-自定义字体">Typora 自定义字体</a></li></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../计算机基础/">计算机基础</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../计算机基础/计算机网络/">计算机网络</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>网络层</a></div></nav><h1 class="article-title">网络层</h1><p show-comma="true" class="content-meta"><time datetime="2024-11-16T13:59:30.362Z">2024年11月16日</time><span>114分钟阅读</span></p><ul class="tags"><li><a href="../../tags/计算机网络" class="internal tag-link">计算机网络</a></li></ul></div></div><article class="popover-hint"><h1 id="网络层概述">网络层概述<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#网络层概述" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>网络层的主要目的<span class="text-highlight">在任意结点间进行数据报不可靠传输</span>。</p>
<p>网络层的主要任务就是<strong>将分组从源主机经过多个网络和多段链路传输到目的主机</strong>，可以将该任务划分为<strong>分组转发</strong>和<strong>路由选择</strong>两种重要的功能。</p>
<h2 id="冲突域">冲突域<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#冲突域" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>冲突域是指能产生冲突的所有设备的集合，这些结点之间存在介质争用的现象。</p>
<p>在 OSI 参考模型中，冲突域被视为第 1 层的概念，像集线器、中继器等简单无脑复制转发信号的第 1 层设备所连接的结点都属于同一个冲突域，也就是说它们不能划分冲突域。而第 2 层（网桥、交换机）、第 3 层（路由器）设备都可以划分冲突域。</p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<p>“域”表示冲突或广播在其中发生并传播的区域。</p>
</div>
</blockquote>
<h2 id="广播域">广播域<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#广播域" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>广播域是指接收同样广播消息的结点集合。也就是说，在该集合中的任何一个结点发送一个广播帧，其他能收到这个帧的结点都被认为是该广播域的一部分。</p>
<p>在 OSI 参考模型中，广播域被视为第 2 层的概念，像第 1 层（集线器等）、第 2 层（交换机等）设备所连接的结点都属于同一个广播域。而路由器，作为第 3 层设备，则可以划分广播域，即可以连接不同的广播域。</p>
<p>通常所说的局域网(LAN)特指使用路由器分割的网络，也就是广播域。</p>
<h2 id="路由与转发">路由与转发<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#路由与转发" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>路由器主要完成两个功能：</p>
<ul>
<li>
<p><span class="text-highlight">路由选择</span>（确定哪一条路径）</p>
<p>根据路由协议<strong>构造路由表</strong>，同时经常或定期地与相邻路由器交换信息，获取网络最新拓扑，动态更新<strong>维护路由表</strong>，以决定分组到达目的地结点的最优路径。</p>
<p>虽然一些路由协议也将延迟等作为参数进行路由选择，但路由协议<strong>使用得最多的参数是传输距离</strong>，此外还有一些其他参数。</p>
</li>
<li>
<p><span class="text-highlight">分组转发</span>（当一个分组到达时所采取的动作）</p>
<p>指路由器根据转发表将分组从合适的端口转发出去，关键操作是转发表查询、转发及相关的队列管理和任务调度等。</p>
<p>路由器只能根据 IP 进行转发。</p>
</li>
</ul>
<p>路由表是根据路由选择算法得出的，而转发表是从路由表得出的。转发表的结构应当使查找过程最优化，路由表则需要最优化网络拓扑变化的计算。</p>
<p>路由表通常包含<span class="text-highlight">目的网络</span>和到<span class="text-highlight">达该目的网络路径上的下一个路由器的 IP 地址</span>。</p>
<p>路由器转发一个分组的过程如下：<strong>先接收整个分组</strong>，然后<strong>对分组进行错误检查</strong>，若出错，则<strong>丢弃</strong>错误的分组；否则<strong>存储</strong>该正确的分组。最后根据路由选择协议，将正确的分组转发到合适的端口，这种机制称为<span class="text-highlight">存储转发机制</span>。</p>
<p><img src="./assets/230.png" alt/></p>
<p>在讨论路由选择的原理时，往往不区分转发表和路由表，而笼统地使用路由表一词。</p>
<h2 id="路由器">路由器<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#路由器" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>路由器主要实现<strong>物理层、数据链路层、网络层的功能</strong>。</p>
<p>路由器是一种具有<span class="text-highlight">多个输入/输出端口</span>的<span class="text-highlight">专用计算机</span>，其任务是连接不同的网络（<strong>连接异构网络</strong>）并<span class="text-highlight">完成分组转发</span>。在多个逻辑网络（即多个广播域）互连时必须使用路由器。</p>
<p>路由器是第三层设备，向传输层及以上层次隐藏下层的具体实现，所以<strong>在路由器互连的多个局域网的结构中</strong>，每个局域网的<span class="text-highlight">物理层、数据链路层、网络层协议可以不同</span>。而网络层之上的协议数据是路由器所不能处理的，因此<span class="text-highlight">网络层以上的高层协议必须相同</span>。</p>
<p>路由器是第三层设备，要处理的内容比第二层设备交换机更多，因而<strong>转发速度比交换机慢</strong>。</p>
<p>通常的路由器可以<strong>支持多种网络层协议</strong>，并提供不同协议之间的分组转发。例如使用特定的路由器连接 IPv4 与 IPv6 网络，就是典型的网络层协议不同而实现互连的例子。</p>
<p>路由器<strong>工作在网络层，不转发广播包</strong>（目的地址为 255.255.255.255 的 IP 包），因此能够<span class="text-highlight">分隔广播域</span>，抑制网络风暴。</p>
<hr/>
<p>当源主机向目标主机发送数据报时，路由器先检查源主机与目标主机是否连接在同一个网络上。</p>
<ul>
<li>若源主机和目标主机<strong>在同一个网络上</strong>，则<span class="text-highlight">直接交付</span>而<strong>无须通过路由器</strong>。</li>
<li>若源主机和目标主机<strong>不在同一个网络上</strong>，则路由器按照转发表（由路由表得出）指出的路由将分组转发给下一个路由器，这称为<span class="text-highlight">间接交付</span>。</li>
</ul>
<p>可见，在同一个网络中传递数据无须路由器的参与，而跨网络通信必须通过路由器进行转发。</p>
<hr/>
<p>从结构上看，路由器由<strong>路由选择</strong>和<strong>分组转发</strong>两部分构成。</p>
<p>从模型的角度看，路由器是网络层设备，它实现了网络模型的下三层，即物理层、数据链路层和网络层。</p>
<p><img src="./assets/339.png" alt/></p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<p>若一个存储转发设备实现了某个层次的功能，则它可以互连两个在该层次上使用不同协议的网段（网络）。若网桥实现了物理层和数据链路层，则网桥可以互连两个物理层和数据链路层不同的网段；但中继器实现了物理层后，却不能互连两个物理层不同的网段，这是因为中继器不是存储转发设备，它属于直通式设备。</p>
</div>
</blockquote>
<p><img src="./assets/340.png" alt/></p>
<p><span class="text-highlight">转发表是从路由表得出的</span>，其表项和路由表项有直接的对应关系。但转发表的格式和路由表的格式不同，其结构应使查找过程最优化，而路由表则需对网络拓扑变化的计算最优化。</p>
<p>转发表中含有一个分组将要发往的目的地址，以及分组的下一跳（即下一步接收者的目的地址，实际为 MAC 地址）。为了减少转发表的重复项目，可以使用一个默认路由代替所有具有相同“下一跳”的项目，并将默认路由设置得比其他项目的优先级低。</p>
<p><span class="text-highlight">路由表总是用软件来实现的</span>；<span class="text-highlight">转发表可以用软件和特殊的硬件来实现</span>。</p>
<p>注意转发和路由选择的区别：</p>
<ul>
<li>“转发”是路由器根据转发表把收到的 IP 数据报从合适的端口转发出去，它仅涉及一个路由器。</li>
<li>“路由选择”则涉及很多路由器，路由表是许多路由器协同工作的结果。这些路由器按照复杂的路由算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由，并由此构造出整个路由表。</li>
</ul>
<p><strong>路由表不等于转发表，分组的实际转发是靠直接查找转发表，而不是查找路由表</strong>。</p>
<p><img src="./assets/341.png" alt/></p>
<h2 id="网络层的服务">网络层的服务<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#网络层的服务" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p><span class="text-highlight">分组交换</span>网根据其通信子网向端点系统提供的服务，还可<strong>进一步分为</strong><span class="text-highlight">面向连接的虚电路服务</span>和<span class="text-highlight">无连接的数据报服务</span>。这两种服务方式都是由网络层提供的。</p>
<ul>
<li>
<p>OSI 参考模型曾主张在网络层使用面向连接的<strong>虚电路服务</strong>，认为应<strong>由<span class="text-highlight">网络自身</span>来保证通信的可靠性</strong>。</p>
<p>虚电路是<span class="text-highlight">面向连接的</span>，它提供的是<span class="text-highlight">可靠的服务</span>，能保证<strong>数据的可靠性和有序性</strong>，但是一旦虚电路中的某个结点出现故障，就必须重新建立一条虚电路。</p>
<p>对于出错率高的传输系统，易出现结点故障，因此采用数据报方式更合适。</p>
</li>
<li>
<p>TCP/IP 体系的网络层提供的是无连接的<strong>数据报服务</strong>，其核心思想是应<strong>由<span class="text-highlight">用户主机</span>来保证通信的可靠性</strong>。</p>
<p>数据报是<span class="text-highlight">无连接的</span>，它提供的是<span class="text-highlight">不可靠的服务</span>，分组有可能丢失、失序，也不保证到达的时间，传输<strong>既不保证可靠性，又不保证分组的按序到达</strong>。</p>
</li>
</ul>
<h3 id="分组交换-虚电路">分组交换-虚电路<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#分组交换-虚电路" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>在虚电路方式中，当两台计算机进行通信时，应当<span class="text-highlight">先建立网络层的连接</span>，也就是建立一条<strong>逻辑上的虚电路</strong>(Virtual Circuit, VC)，连接一旦建立，就固定了虚电路对应的物理路径。</p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<p>虚电路提供的服务包括：</p>
<ul>
<li>永久性虚电路（PVC）：提前定义好的、基本上不需要任何建立时间的端点之间的连接。</li>
<li>交换型虚电路（SVC）：端点之间的一种临时性连接，这些连接只持续所需的时间，且在会话结束时就取消这种连接。</li>
</ul>
</div>
</blockquote>
<p><img src="./assets/226.png" alt/></p>
<p>每次建立虚电路时，将一个未用过的虚电路号(VCID)分配给该虚电路，以区别于本系统中的其他虚电路，然后双方就沿着已建立的虚电路传送分组。</p>
<p>分组的<strong>首部仅在连接建立时使用完整的目的地址</strong>，<strong>之后</strong>每个分组的首部<strong>只需携带这条虚电路的编号</strong>即可。</p>
<p>在虚电路网络中的每个结点上都维持一张虚电路表，表中每项记录一个打开的虚电路的信息，包括在接收链路和发送链路上的虚电路号、前一结点和下一结点的标识，它是在虚电路建立过程中确定的。</p>
<p>与电路交换类似，整个通信过程分为三个阶段：</p>
<ol>
<li>
<p><span class="text-highlight">虚电路建立</span></p>
<p>数据传输前，主机 A 与主机 B 先建立连接，主机 A 发出“呼叫请求”分组，该分组通过中间结点送往主机 B，若主机 B 同意连接，则发送“呼叫应答”分组予以确认。</p>
</li>
<li>
<p><span class="text-highlight">数据传输</span></p>
<p>虚电路建立后，主机 A 和主机 B 就可相互传送数据分组。</p>
</li>
<li>
<p><span class="text-highlight">虚电路释放</span></p>
<p>传送结束后，主机 A 通过发送“释放请求”分组来拆除虚电路，逐段断开整个连接。</p>
</li>
</ol>
<p><img src="./assets/227.png" alt/></p>
<p>虚电路服务具有如下特点：</p>
<ol>
<li>虚电路通信链路的建立和拆除需要时间开销，对交互式应用和少量的短分组情况显得很浪费，但<span class="text-highlight">对长时间、频繁的数据交换效率较高</span>。</li>
<li>虚电路的路由选择体现在连接建立阶段，连接建立后，就确定了传输路径。</li>
<li>虚电路提供了<strong>可靠的通信功能，本身就可实现差错控制，不需要依赖其他协议实现差错控制</strong>;能<strong>保证每个分组正确且有序到达</strong>。此外，还可对两个端点的流量进行控制，当接收方来不及接收数据时，可以通知发送方暂缓发送。</li>
<li>虚电路有一个致命的弱点，即<span class="text-highlight">当网络中的某个结点或某条链路出现故障而彻底失效时，所有经过该结点或该链路的虚电路将遭到破坏</span>。</li>
<li><span class="text-highlight">分组首部包含的是虚电路号</span>，不包含目的地址,相对于数据报方式，其开销小。</li>
</ol>
<p>虚电路之所以是虚，是因为这条电路不是专用的，每个结点到其他结点之间的链路可能同时有若干条虚电路通过，也可能同时在多个结点之间建立虚电路。</p>
<p>网络中的传输是否有确认与网络层提供的两种服务没有任何关系。</p>
<h3 id="分组交换-数据报">分组交换-数据报<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#分组交换-数据报" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>在互联网采用的 TCP/IP 体系结构中，网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务</strong>。也就是说，所传送的分组可能出错、丢失、重复、失序或超时，这就使得网络中的路由器可以做得比较简单，而且价格低廉（与电话网络相比）。</p>
<p>网络在发送分组前<span class="text-highlight">不需要先建立连接</span>。</p>
<p>源主机的高层协议将报文拆成若干较小的数据段，并加上地址等控制信息后构成分组。中间结点存储分组很短一段时间，找到最佳的路由后，尽快转发每个分组。</p>
<p><img src="./assets/228.png" alt/></p>
<p>当分组正在某一链路上传送时，<strong>分组并不占用网络其他部分的资源</strong>。因为<strong>采用存储转发技术，资源是共享的</strong>，所以主机 A 在发送分组时，主机 B 也可同时向其他主机发送分组。</p>
<p>数据报服务具有如下特点：</p>
<ol>
<li><strong>发送分组前不需要建立连接</strong>。发送方可随时发送分组，网络中的结点可随时接收分组。</li>
<li>网络<strong>尽最大努力交付，传输不保证可靠性</strong>，所以分组可能出错或丢失；网络为每个分组独立地选择路由，转发的路径可能不同，因此分组不一定按序到达目的结点。</li>
<li>发送的分组中要<strong>包括发送方和接收方的完整地址</strong>，以便可以独立传输。</li>
<li>当分组在交换结点<strong>存储转发时，需要排队等候处理</strong>，这会带来一定的时延。当网络发生拥塞时，这种时延会大大增加，交换结点还可根据情况丢弃部分分组。</li>
<li>网络具有余路径，当某个交换结点或一条链路出现故障时，可相应地更新转发表，寻找另一条路径转发分组，对故障的适应能力强。</li>
<li>收发双方<strong>不独占某条链路，资源利用率较高</strong>。</li>
</ol>
<p>采用这种设计思想的好处是：网络的造价大大降低、运行方式灵活、能够适应多种应用。</p>
<h3 id="比较">比较<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#比较" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><img src="./assets/379.png" alt/></p>
<h2 id="异构网络互连">异构网络互连<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#异构网络互连" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>互联网是由全球范围内数以百万计的异构网络互连起来的。这些网络的拓扑结构、寻址方案、差错处理方法、路由选择机制等都不尽相同，即<span class="text-highlight">数据链路层和物理层均不同</span>。网络层所要完成的任务之一就是使这些异构的网络实现互连。</p>
<p>网络互连是指将两个以上的计算机网络，通过一定的方法，用一些中继系统相互连接起来，以构成更大的网络系统。</p>
<p>根据所在的层次，中继系统分为以下 4 种：</p>
<ol>
<li>物理层中继系统：转发器，集线器。</li>
<li>数据链路层中继系统：网桥或交换机。</li>
<li>网络层中继系统：路由器。</li>
<li>网络层以上的中继系统：网关。</li>
</ol>
<p>当使用物理层或数据链路层的中继系统时，只是把一个网络扩大了，而从网络层的角度看，它仍然是同一个网络，一般并不称为网络互连。因此，<span class="text-highlight">网络互连通常是指用路由器进行网络连接和路由选择</span>。</p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<p>路由器是一台专用计算机，用于在互联网中进行路由选择。</p>
<p>许多有关 TCP/IP 的文献也将网络层的路由器称为网关。</p>
</div>
</blockquote>
<p>TCP/IP 在网络互连上采用的做法是在网络层采用标准化协议，但相互连接的网络可以是异构的。</p>
<p>虚拟互连网络也就是逻辑互连网络，意思是互连起来的各种物理网络的异构性本来是客观存在的，但是通过 IP 协议就可使这些性能各异的网络在网络层上看起来像是一个统一的网络。这种<strong>使用 IP 协议的虚拟互连网络可简称为 IP 网络</strong>。</p>
<p><img src="./assets/229.png" alt/></p>
<p>使用 IP 网络的好处是：当 IP 网上的主机进行通信时，就好像在单个网络上通信一样，而看不见互连的各个网络的具体异构细节（如具体的编址方案、路由选择协议等）。</p>
<h2 id="软件定义网络sdn">软件定义网络(SDN)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#软件定义网络sdn" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>网络层的主要任务是转发和路由选择。可以将网络层抽象地划分为数据平面（也称转发层面）和控制平面，转发是数据平面实现的功能，而路由选择是控制平面实现的功能。</p>
<p><img src="./assets/376.png" alt/></p>
<p><strong>软件定义网络</strong>(SoftwareDefinedNetwork, <strong>SDN</strong>)是近年流行的一种创新网络架构，它采用集中式的控制平面和分布式的数据平面，两个平面相互分离，控制平面利用控制-数据接口对数据平面上的路由器进行集中式控制，方便软件来控制网络。</p>
<p>传统网络中的路由器既有转发表又有路由选择软件，即既有数据平面又有控制平面。但是在 SDN 结构中，路由器都变得简单了，它的路由选择软件都不需要了，因此路由器之间不再相互交换路由信息。</p>
<p>在网络的控制平面有一个逻辑上的远程控制器（可由多个服务器组成）。远程控制器掌握各主机和整个网络的状态，为每个分组计算出最佳路由，通过 Openflow 协议（或其他途径）将转发表（在 SDN 中称为流表）下发给路由器。路由器的工作很单纯，即收到分组、查找转发表、转发分组。</p>
<p><img src="./assets/377.png" alt/></p>
<p>这样，网络又变成集中控制的，而本来互联网是分布式的。SDN 并非要把整个互联网都改造成集中控制模式，这是不现实的。然而，在某些具体条件下，特别是像一些大型的数据中心之间的广域网，使用 SDN 模式来建造，就可使网络的运行效率更高。</p>
<p>SDN 的可编程性通过为开发者提供强大的编程接口，使得网络具有很好的编程性。</p>
<ul>
<li>
<p>对上层应用的开发者，SDN 提供的<strong>编程接口</strong>称为<strong>北向接口</strong>，北向接口提供了一系列丰富的 API，开发者可以在此基础上设计自已的应用，而不必关心底层的硬件细节。</p>
</li>
<li>
<p>SDN 控制器和转发设备<strong>建立双向会话的接口</strong>称为<strong>南向接口</strong>，通过不同的南向接口协议（如 Openflow），SDN 控制器就可兼容不同的硬件设备，同时可在设备中实现上层应用的逻辑。</p>
</li>
<li>
<p>SDN 控制器集群<strong>内部控制器之间的通信接口</strong>称为<strong>东西向接口</strong>，用于增强整个控制平面的可靠性和可拓展性。</p>
</li>
</ul>
<p><img src="./assets/378.png" alt/></p>
<p>SDN 的优点：</p>
<ol>
<li>全局集中式控制和分布式高速转发，既利于控制平面的全局优化，又利于高性能的网络转发。</li>
<li>灵活可编程与性能的平衡，控制和转发功能分离后，使得网络可以由专有的自动化工具以编程方式配置。</li>
<li>降低成本，控制和数据平面分离后，尤其是在使用开放的接口协议后，就实现了网络设备的制造与功能软件的开发相分离，从而有效降低了成本。</li>
</ol>
<p>SDN 的问题：</p>
<ol>
<li>安全风险，集中管理容易受攻击，若崩溃，则整个网络会受到影响。</li>
<li>瓶颈问题，原本分布式的控制平面集中化后，随着网络规模扩大，控制器可能成为网络性能的瓶颈。</li>
</ol>
<h1 id="ipv4">IPV4<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ipv4" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>IPv4 即现在普遍使用的网际协议(IntemetProtocol, IP)。</p>
<p>IPv4 地址是给因特网(Internet)上的每一个主机（或路由器）的每一个接口分配的一个在全世界范围内唯一的<span class="text-highlight">32 比特</span>的标识符。IP 地址由互联网名字和数字分配机构 ICANN 进行分配。</p>
<p>IP 定义数据传送的基本单元一一 IP 分组及其确切的数据格式。IP 也包括一套规则，指明分组如何处理、错误怎样控制。</p>
<h2 id="ipv4-地址">IPv4 地址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ipv4-地址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p><img src="./assets/231.png" alt/></p>
<h3 id="表示方法">表示方法<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#表示方法" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>由于 IPv4 地址由 32 比特构成，不方便阅读、记录以及输入等，因此 IPv4 地址采用<strong>点分十进制表示方法</strong>以方便用户使用。</p>
<p><img src="./assets/232.png" alt/></p>
<p><img src="./assets/233.png" alt/></p>
<h3 id="分类编址">分类编址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#分类编址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><img src="./assets/234.png" alt/></p>
<p><img src="./assets/236.png" alt/></p>
<p>无论哪类 IP 地址，都由网络号和主机号两部分组成。即</p>
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">IP</span><span class="mord cjk_fallback">地址</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">::=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord cjk_fallback">网络号</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord cjk_fallback">主机号</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">}</span></span></span></span></span>
<ul>
<li>网络号标志主机（或路由器）所连接到的网络，一个网络号在整个互联网范围内必须是唯一的。</li>
<li>主机号标志该主机（或路由器），一台主机号在它前面的网络号所指明的网络范围内必须是唯一的。</li>
</ul>
<p>由此可见，一个 IP 地址在整个互联网范围内是唯一的。</p>
<h4 id="特殊-ip-地址">特殊 IP 地址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#特殊-ip-地址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>在各类 IP 地址中，有些 IP 地址具有特殊用途，不用作主机的 IP 地址：</p>
<ul>
<li><strong>主机号全为 0 表示本网络本身，不能分配给主机（或路由器）的各接口</strong>。</li>
<li><strong>主机号全为 1 表示本网络的广播地址，又称直接广播地址，不能分配给主机（或路由器）的各接口。</strong></li>
<li>127.x.x.x 保留为环回自检地址，此地址表示任意主机本身，目的地址为环回地址的 IP 数据报永远不会出现在任何网络上。</li>
<li>32 位全为 0，即 0.0.0.0 表示本网络上的本主机。</li>
<li>32 位全为 1，即 255.255.255.255 表示整个 TCP/IP 网络的广播地址，又称受限广播地址。实际使用时，因为路由器对广播域的隔离，255.255.255.255 等效为本网络的广播地址。</li>
</ul>
<p><img src="./assets/241.png" alt/></p>
<p><img src="./assets/235.png" alt/></p>
<p><img src="./assets/237.png" alt/></p>
<p><img src="./assets/238.png" alt/></p>
<p><img src="./assets/239.png" alt/></p>
<p><img src="./assets/240.png" alt/></p>
<h4 id="ip-地址特点">IP 地址特点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ip-地址特点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>
<p>每个 IP 地址都由网络号和主机号两部分组成，因此 IP 地址是一种分等级的地址结构。</p>
<p>分等级的好处是：</p>
<ul>
<li>IP 地址管理机构在分配 IP 地址时只分配网络号，而主机号则由得到该网络的单位自行分配，方便了 IP 地址的管理；</li>
<li>路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目标主机号），从而减小了路由表所占的存储空间。</li>
</ul>
</li>
<li>
<p>IP 地址是标志一台主机（或路由器）和一条链路的接口。当一台主机同时连接到两个网络时，该主机就必须同时具有两个相应的 IP 地址，其网络号必须是不同的。因此<strong>路由器至少应具有两个或两个以上的 IP 地址，每个端口都有一个不同网络号的 IP 地址</strong>。</p>
</li>
<li>
<p>用<strong>转发器或桥接器（网桥等）连接的若干 LAN 仍然是同一个网络</strong>（同一个广播域），因此该 LAN 中所有主机的 IP 地址的<strong>网络号必须相同，主机号必须不同</strong>。</p>
</li>
<li>
<p>在 IP 地址中，所有分配到网络号的网络都是平等的。</p>
</li>
<li>
<p>在同一个局域网上的主机或路由器接口的 IP 地址中的网络号必须是相同的。</p>
</li>
</ol>
<h3 id="划分子网编址">划分子网编址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#划分子网编址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>把 IP 网络划分成子网，这样做的好处减少广播域的大小。增加子网的数量是子网划分的结果，并不是目的。</p>
<h4 id="划分子网">划分子网<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#划分子网" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>两级 IP 地址的缺点：IP 地址空间的利用率有时很低；给每个物理网络分配一个网络号会使路由表变得太大，进而使网络性能变坏；两级 IP 地址不够灵活。</p>
<p><img src="./assets/242.png" alt/></p>
<p><img src="./assets/243.png" alt/></p>
<p>从 1985 年起，在 IP 地址中又增加了一个“子网号字段”，使两级 IP 地址变成了三级 IP 地址。这种做法称为划分子网。</p>
<p>划分子网已成为互联网的正式标准协议。</p>
<p>划分子网的基本思路如下：</p>
<ul>
<li>
<p>划分子网纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的一个网络。</p>
</li>
<li>
<p>划分子网的方法是<strong>从网络的主机号借用若干位作为子网号</strong>，当然主机号也相应减少了相同的位数。三级 IP 地址的结构：</p>
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">IP</span><span class="mord cjk_fallback">地址</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">::=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord cjk_fallback">网络号</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord cjk_fallback">子网号</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord cjk_fallback">主机号</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">}</span></span></span></span></span>
</li>
<li>
<p>路由器<strong>转发分组根据的仍然是 IP 数据报的目的网络号</strong>，本单位的路由器<strong>收到 IP 数据报后，再按目的网络号和子网号找到目的子网</strong>。最后把 IP 数据报交付给目的主机。</p>
</li>
</ul>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<ol>
<li>划分子网只是把 IP 地址的主机号部分进行再划分，而不改变 IP 地址原来的网络号。因此，<strong>从一个 IP 地址本身无法判断该主机所连接的网络是否进行了子网划分</strong>。</li>
<li>子网中的主机号全 0 或全 1 的地址不能被指派，其中主机号全 0 的地址为子网的网络地址，主机号全 1 的地址为子网的广播地址。</li>
<li>划分子网增加了灵活性，但减少了能够连接在网络上的主机总数。</li>
</ol>
</div>
</blockquote>
<h4 id="子网掩码">子网掩码<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#子网掩码" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>子网掩码可用来指明分类 IP 地址的主机号部分被借用了多少位作为子网号。</p>
<p>子网掩码是一个长 32 位的二进制串，由一串 1 和跟随的一串 0 组成。其中，1 对应于 IP 地址中的网络号及子网号，而 0 对应于主机号。</p>
<p><img src="./assets/244.png" alt/></p>
<p>主机或路由器只需将 IP 地址和其对应的子网掩码逐位“与”（AND 运算），就可得出相应子网的网络地址。</p>
<p><img src="./assets/245.png" alt/></p>
<p><img src="./assets/246.png" alt/></p>
<p><img src="./assets/247.png" alt/></p>
<p><img src="./assets/248.png" alt/></p>
<p>默认子网掩码是指在未划分子网的情况下使用的子网掩码。</p>
<p><img src="./assets/249.png" alt/></p>
<h4 id="默认网关">默认网关<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#默认网关" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>默认网关是<span class="text-highlight">子网与外部网络连接的设备</span>，也就是连接本机或子网的路由器接口的 IP 地址。</p>
<p>当主机发送数据时，<strong>根据所发送数据的目的 IP 地址，通过子网掩码来判定目的主机是否在子网中</strong>，若目的主机在子网中，则直接发送。若目的主机不在子网中，则将该数据发送到默认网关，由网关（路由器）将其转发到其他网络，进一步寻找目的主机。</p>
<p>现在的互联网标准规定：所有网络都必须使用子网掩码。若一个网络未划分子网，则该网络的子网掩码就使用默认子网掩码。</p>
<p>子网掩码是一个网络的重要属性，路由器相互之间交换路由信息时，必须将自己所在网络的子网掩码告诉对方。分组转发时，路由器将分组的目标地址和某网络的子网掩码按位相与，若结果与该网络地址一致，则路由匹配成功，路由器将分组转发至该网络。</p>
<p>在使用子网掩码的情况下：</p>
<ol>
<li>一台主机在设置 IP 地址信息的同时，必须设置子网掩码。</li>
<li>同属于一个子网的所有主机及路由器的相应端口，必须设置相同的子网掩码。</li>
<li>路由器的路由表中所包含的信息主要内容有目的网络地址、子网掩码、下一跳地址。</li>
</ol>
<h3 id="无分类编址-cidr">无分类编址 CIDR<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#无分类编址-cidr" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="无分类编址">无分类编址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#无分类编址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><span class="text-highlight">无分类域间路由选择</span>(ClasslessInter-DomainRouting, <span class="text-highlight">CIDR</span>)是在变长子网掩码的基础上，提出的一种消除传统 A、B、C 类地址及划分子网的概念。</p>
<p>无分类编址方法使用的地址掩码与划分子网使用的子网掩码类似，由<span class="text-highlight">32 比特构成</span>。用左起多个连续的比特 1 对应 IPv4 地址中的网络前缀；之后的多个连续的比特 0 对应 IPv4 地址中的主机号。</p>
<p>CIDR 使用网络前缀的概念代替网络的概念，与传统分类 IP 地址最大的区别就是，网络前缀的位数不是固定的，可以任意选取。</p>
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">IP</span><span class="mord cjk_fallback">地址</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">::=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord cjk_fallback">网络前缀</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord text"><span class="mord cjk_fallback">主机号</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">}</span></span></span></span></span>
<p><img src="./assets/250.png" alt/></p>
<p>CIDR 还使用<span class="text-highlight">斜线记法</span>（或称 CIDR 记法），即记为“<span class="text-highlight">IP 地址/网络前缀所占的位数</span>”。</p>
<p><img src="./assets/251.png" alt/></p>
<p>CIDR 将网络前缀都相同的连续 IP 地址组成一个<strong>CIDR 地址块</strong>。只要知道 CIDR 地址块中的任何一个地址，就能知道这个地址块的最小地址和最大地址，以及地址块中的地址数。</p>
<p>CIDR 虽然不使用子网，但仍然使用“掩码”一词。“CIDR 不使用子网”是指 CIDR 并没有在 32 位地址中指明若干位作为子网字段。但分配到一个 CIDR 地址块的单位，仍可在本单位内根据需要划分出一些子网。例如，某单位分配到地址块/20，就可继续划分为 8 个子网（从主机号中借用 3 位来划分子网），这时每个子网的网络前缀就变成了 23 位。</p>
<p>CIDR 地址块中的地址数一定是 2 的整数次幂，实际可指派的地址数通常为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9247em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>，N 表示主机号的位数，<span class="text-highlight">主机号全 0 代表网络号，主机号全 1 为广播地址</span>。网络前缀越短，其地址块包含的地址数就越多。</p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<p>注意地址数和实际可指派的地址数的区别</p>
</div>
</blockquote>
<p><img src="./assets/252.png" alt/></p>
<p><img src="./assets/253.png" alt/></p>
<p><img src="./assets/254.png" alt/></p>
<h4 id="路由聚合">路由聚合<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#路由聚合" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>因为一个 CIDR 地址块中有很多地址，所以在路由表中就可利用 CIDR 地址块来查找目的网络。</p>
<p>这种地址的聚合称为路由聚合，也称构成超网，它使得路由表中的一个项目可以表示多个原来传统分类地址的路由，有利于减少路由器之间的信息交换，进而提高网络性能。</p>
<p><img src="./assets/255.png" alt/></p>
<p>网络前缀越长，地址块越小，路由越具体；因此若路由器查表转发分组时发现有多条路由条目匹配，则选择网络前缀最长的那条路由条目，这称为<span class="text-highlight">最长前缀匹配</span>，因为这样的路由更具体。</p>
<p><img src="./assets/256.png" alt/></p>
<p><img src="./assets/257.png" alt/></p>
<p><img src="./assets/2024-11-25_170115_374.png" alt="2024-11-25_170115_374"/></p>
<p><img src="./assets/382.png" alt/></p>
<p><img src="./assets/383.png" alt/></p>
<h3 id="子网划分应用举例">子网划分应用举例<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#子网划分应用举例" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>通常有两类划分子网的方法：采用定长的子网掩码，采用变长的子网掩码。</p>
<h4 id="定长子网掩码">定长子网掩码<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#定长子网掩码" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><img src="./assets/261.png" alt/></p>
<p><img src="./assets/263.png" alt/></p>
<p><img src="./assets/264.png" alt/></p>
<p><img src="./assets/265.png" alt/></p>
<p><img src="./assets/266.png" alt/></p>
<h4 id="变长子网掩码">变长子网掩码<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#变长子网掩码" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><img src="./assets/262.png" alt/></p>
<p><img src="./assets/267.png" alt/></p>
<p><img src="./assets/268.png" alt/></p>
<p><img src="./assets/269.png" alt/></p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>每个子块的位置不能随便选取的原因 </p></div>
                  
                </div>
<div class="callout-content">
<p>每个子网的最小地址只能选取主机号全 0 的地址，最大地址只能选取主机号全 1 的地址。</p>
<p>在上图中，如果 218.75.230.0000 0100(218.75.230.4)作为某个网络的起点，那么该网络只有 4 个地址。但此时 1，2，3，4 网络所需地址都大于 4，即 218.75.230.4 无法作为 1，2，3，4 网络的起点。</p>
</div>
</blockquote>
<p><img src="./assets/380.png" alt/></p>
<p><img src="./assets/381.png" alt/></p>
<h2 id="ipv4-数据报">IPv4 数据报<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ipv4-数据报" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>IPv4 数据报的首部格式及其内容是实现 IPv4 协议各种功能的基础。在 TCP/IP 标准中，各种数据格式常常以 32 比特（即 4 字节）为单位来描述。</p>
<h3 id="格式">格式<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#格式" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>一个 IP 分组（或称 IP 数据报）由首部和数据部分组成。首部前一部分的长度固定，共 20B，是所有 IP 分组必须具有的。在首部固定部分的后面是一些可选字段，其长度可变，用来提供错误检测及安全等机制。</p>
<p><img src="./assets/278.png" alt/></p>
<ul>
<li>
<p><span class="text-highlight">版本</span></p>
<p><strong>占 4 位</strong>。指 IP 的版本，<span class="text-highlight">IPv4 数据报中该字段值是 4</span>。</p>
</li>
<li>
<p><span class="text-highlight">首部长度</span></p>
<p><strong>占 4 位</strong>。以 <span class="text-highlight">4B 为单位</span>，最大可表示的首部长度为 60B（15x4B）。最常用的首部长度是 20B（5x4B），该字段值是 5，此时不使用任何可选字段。</p>
</li>
<li>
<p><span class="text-highlight">总长度</span></p>
<p><strong>占 16 位</strong>。指<span class="text-highlight">首部和数据之和的长度</span>，<span class="text-highlight">单位为字节</span>，因此数据报的最大长度为 2^16^-1=65535B（但很少传输这么长的 IPv4 数据报）。</p>
<p><strong>以太网帧的最大传送单元（MTU）为 1500B（包含首部和数据）</strong>，因此当一个 IP 数据报封装成帧时，<span class="text-highlight">数据报的总长度（首部加数据）一定不能超过下面的数据链路层的 MTU 值</span>。</p>
<p><img src="./assets/279.png" alt/></p>
</li>
<li>
<p><span class="text-highlight">标识</span></p>
<p><strong>占 16 位</strong>。属于<span class="text-highlight">同一个 IPv4 数据报的各分片数据报应该具有相同的标识</span>。</p>
<p>IP 软件会维持一个计数器，每产生一个 IPv4 数据报，计数器值就加 1，并将此值赋给标识字段。但它并不是“序号”（因为 IP 是无连接服务）。</p>
<p>当一个数据报的长度超过网络的 MTU 时，必须分片，此时每个数据报片都复制一次标识号，以便能正确地重装成原来的数据报。</p>
</li>
<li>
<p><span class="text-highlight">标志(Flag)</span></p>
<p><strong>占 3 位</strong>。</p>
<ul>
<li>标志字段的最低位为<span class="text-highlight">(More Fragment)MF</span>，MF=<strong>1 表示本分片后面还有分片</strong>，MF=<strong>0 表示本分片后面没有分片</strong>。</li>
<li>标志字段的中间位为<span class="text-highlight">(Don’t Fragment)DF</span>，DF=<strong>1 表示不允许分片</strong>，DF=<strong>0 表示允许分片</strong>。</li>
<li>最高位为保留位，必须设置为 0。</li>
</ul>
</li>
<li>
<p><span class="text-highlight">片偏移</span></p>
<p><strong>占 13 位</strong>。它指出较长的数据报在分片后，某片在原数据报中的相对位置，片偏移<span class="text-highlight">以 8B 为偏移单位</span>，且<span class="text-highlight">值必须为整数</span>。</p>
<p><strong>除最后一个分片外，每个分片的长度一定是 8B 的整数倍</strong>，否则，会造成其相邻后续分片数据报的片偏移不是整数。</p>
</li>
<li>
<p><span class="text-highlight">生存时间</span>(<span class="text-highlight">TTL</span>, Time To Live)</p>
<p><strong>占 8 位</strong>。数据报在网络中<span class="text-highlight">可通过的路由器数的最大值</span>，<strong>标识数据报在网络中的寿命，以确保数据报不会永远在网络中循环</strong>。</p>
<p>路由器在转发数据报前，先将 TTL 减 1。若 TTL 被减为 0，则该数据报必须丢弃。</p>
<p><img src="./assets/284.png" alt/></p>
</li>
<li>
<p><span class="text-highlight">协议</span></p>
<p><strong>占 8 位</strong>。指出此数据报携带的数据使用何种协议，即<span class="text-highlight">数据报的数据部分应上交给哪个协议进行处理</span>，如 TCP、UDP 等。</p>
</li>
<li>
<p><span class="text-highlight">首部检验和</span></p>
<p><strong>占 16 位</strong>。它<span class="text-highlight">只检验数据报的首部</span>，但<span class="text-highlight">不包括数据部分</span>。这是因为数据报每经过一个路由器，都要重新计算首部检验和（有些字段，如生存时间、总长度、标志、片偏移、源/目的地址都可能发生变化），不检验数据部分可减少计算的工作量。</p>
<p>计算检验和的方法是先把数据报的首部划分为许多 16 比特的序列，用反码算术运算把所有 16 比特相加后，将得到的和的反码写入检验和字段。</p>
<p>接收方的网络层发现检验和出错后，就<strong>丢弃收到的数据报</strong>，但<strong>不会发送差错报文</strong>。</p>
</li>
<li>
<p><span class="text-highlight">源地址字段</span></p>
<p>占 4B，标识发送方的 IP 地址。</p>
</li>
<li>
<p><span class="text-highlight">目的地址字段</span></p>
<p>占 4B，标识接收方的 IP 地址。</p>
</li>
<li>
<p>可选字段</p>
<p>长度从 1 字节到 40 字节不等，用来支持排错、测量以及安全措施等功能。实际上，可选字段很少被使用。</p>
</li>
<li>
<p>填充</p>
<p>用来确保 IPv4 数据报的首部长度是 4 字节的整数倍，使用全 0 进行填充。</p>
<p>当首部长度（20 字节固定部分+可变部分）的长度不是 4 字节整数倍时，填充相应数量的全 0 字节，以确保 IPv4 数据报的首部长度是 4 字节的整数倍。</p>
</li>
</ul>
<h3 id="分片">分片<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#分片" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><img src="./assets/280.png" alt/></p>
<p>一个链路层数据帧<span class="text-highlight">能承载的最大数据量</span>称为<span class="text-highlight">最大传送单元(MTU)</span>。</p>
<p>因为 IP 数据报被封装在链路层的帧中，因此链路层的 MTU 严格地限制   上的各段链路可能使用不同的链路层协议，有不同的 MTU。</p>
<p>当 IP 数据报的总长度大于链路 MTU 时，就需要将 IP <span class="text-highlight">数据报中的数据</span>分装在多个较小的 IP 数据报中，这些较小的数据报称为片。</p>
<p><img src="./assets/281.png" alt/></p>
<p><img src="./assets/282.png" alt/></p>
<p><img src="./assets/283.png" alt/></p>
<h3 id="发送">发送<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#发送" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>IP 数据报的发送和转发过程包含以下两个过程：主机发送 IP 数据报，路由器转发 IP 数据报。</p>
<p><img src="./assets/286.png" alt/></p>
<p><img src="./assets/285.png" alt/></p>
<p>若目的主机不在子网中，则将该数据发送到默认网关，由网关（路由器）将其转发到其他网络，进一步寻找目的主机。</p>
<h3 id="转发">转发<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#转发" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>当分组到达路由器后，路由器根据目的 IP 地址的网络前缀来查找转发表，确定下一跳应当到哪个路由器。</p>
<p>因此，在转发表中，每条路由必须有：目的网络地址，下一跳地址。</p>
<p>这样，IP 数据报最终一定可以找到目的主机所在目的网络上的路由器（可能要通过多次间接交付），当到达最后一个路由器时，才试图向目的主机进行直接交付。</p>
<p>采用 CIDR 编址时，若一个分组在转发表中可以找到多个匹配的前缀，则应当使用最长前级匹配。</p>
<p><strong>为了更快地查找转发表</strong>，可以按照前缀的长短，将前缀最长的排在第 1 行，<strong>按前缀长度的降序排列</strong>。这样，从第 1 行最长的开始查找，只要检索到匹配的，就不必再继续查找。</p>
<p>综上所述，归纳出路由器执行的分组转发算法如下：</p>
<ol>
<li>从收到的 IP 分组的首部提取目的主机的 IP 地址。</li>
<li>若查找到特定主机路由，则按照这条路由的下一跳转发分组；否则从转发表中的下一条开始检查，执行步骤 3）。</li>
<li>将这一行的子网掩码与目的地址逐位“与”。若运算结果与本行的前缀匹配，则查找结束，按照“下一跳”指出的进行处理（或者直接交付本网络上的目的主机，或通过指定接口发送到下一跳路由器）。否则，若转发表还有下一行，则对下一行进行检查，直到转发表没有下一行。</li>
<li>若转发表中有一个默认路由，则把分组传送给默认路由；否则，报告转发分组出错。</li>
</ol>
<p><img src="./assets/287.png" alt/></p>
<p><img src="./assets/288.png" alt/></p>
<p><img src="./assets/289.png" alt/></p>
<p><img src="./assets/290.png" alt/></p>
<p>值得注意的是，转发表（或路由表）并没有给分组指明到某个网络的完整路径（即先经过哪个路由器，然后经过哪个路由器等）。转发表指出，到某个网络应当先到某个路由器（即下一跳路由器），到达下一跳路由器后，再继续查找其转发表，知道再下一步应当到哪个路由器。这样一步一步地查找下去，直到最后到达目的网络。</p>
<p>得到下一跳路由器的 IP 地址后，并不是直接将该地址填入待发送的数据报，而是将该 IP 地址转换成 MAC 地址（通过 ARP），将此 MAC 地址填入 MAC 帧首部，然后根据这个 MAC 地址找到下一跳路由器。在不同网络中传送时，MAC 帧的源地址和目的地址要发生变化。</p>
<h2 id="网络地址转换nat">网络地址转换(NAT)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#网络地址转换nat" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>网络地址转换(NetworkAddressTranslation, NAT)是指通过<strong>将专用网络地址如（如 Intranet）转换为公用地址（如 Interme），从而对外隐藏内部管理的 IP 地址</strong>。</p>
<p>它使得整个专用网只需要一个全球 IP 地址就可与互联网连通，因为专用网本地 IP 地址是可重用的，所以 NAT 大大节省了 IP 地址的消耗。同时，它隐藏了内部网络结构，从而降低了内部网络受到攻击的风险。</p>
<p>此外，为了网络安全，划出了部分 IP 地址为私有 IP 地址。私有 IP 地址只用于 LAN，不用于 WAN 连接（因此<span class="text-highlight">私有 IP 地址不能直接用于 Internet</span>，必须通过网关利用 NAT 把私有 IP 地址转换为 Intermet 中合法的全球 IP 地址后才能出现在 Internet 上），并且允许私有 IP 地址被 LAN 重复使用。这有效地解决了 IP 地址不足的问题。</p>
<p>在互联网中的所有路由器，对目的地址是私有地址的数据报一律不进行转发。这种采用私有 IP 地址的互联网络称为专用互联网或本地互联网。<strong>私有 IP 地址也称可重用地址</strong>。</p>
<p>私有 IP 地址网段：</p>
<ul>
<li>10.X.X.X</li>
<li>172.16.XX ~ 172.31.X.X</li>
<li>192.168.X.X ~ 192.168.X.X</li>
</ul>
<h3 id="基本的-nat-方法">基本的 NAT 方法<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#基本的-nat-方法" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>使用 NAT 时需要在专用网连接到互联网的路由器上安装 NAT 软件，<strong>NAT 路由器至少有一个有效的外部全球 IP 地址</strong>。当使用本地地址的主机和外界通信时，NAT 路由器使用 NAT 转换表进行本地 IP 地址和全球 IP 地址的转换。</p>
<p><img src="./assets/342.png" alt/></p>
<p><img src="./assets/343.png" alt/></p>
<h3 id="网络地址与端口号转换方法napt">网络地址与端口号转换方法(NAPT)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#网络地址与端口号转换方法napt" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>将 NAT 和运输层端口号结合使用，称为<strong>网络地址与端口号转换</strong>(Network Address and Port Translation，<strong>NAPT</strong>)</p>
<p>由于目前绝大多数基于 TCP/IP 协议栈的网络应用，都使用运输层的传输控制协议 TCP 或用户数据报协议 UDP，为了更加有效地利用 NAT 路由器中的全球 IP 地址，现在常将 NAT 转换和运输层端口号结合使用。</p>
<p>这样，只需要一个全球 IP 地址，就可让多台主机同时访问互联网。</p>
<p><img src="./assets/344.png" alt/></p>
<p><img src="./assets/345.png" alt/></p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<p>普通路由器在转发 IP 分组时，其源 IP 地址和目的 IP 地址都不会改变。而 NAT 路由器在转发 IP 分组时，一定要更换其 IP 地址（转换源 IP 地址或目的 IP 地址）。</p>
<p>普通路由器仅工作在网络层，而 NAT 路由器转发数据报时需要查看和转换传输层的端口号。</p>
</div>
</blockquote>
<h3 id="特点">特点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#特点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>NAT（和 NAPT）的一个重要特点就是<span class="text-highlight">通信必须由专用网内部发起</span>，因此拥有内部专用地址的主机不能直接充当因特网中的服务器。</p>
<p><img src="./assets/346.png" alt/></p>
<h2 id="地址解析协议arp">地址解析协议(ARP)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#地址解析协议arp" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="ip-地址与-mac-地址">IP 地址与 MAC 地址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ip-地址与-mac-地址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>IP 地址是网络层及网络层之上使用的地址，它是分层式的。</p>
<p><img src="./assets/270.png" alt/></p>
<p>因为路由器的隔离，IP 网络中无法通过广播 MAC 地址来完成跨网络的寻址，所以在网络层只使用 IP 地址来完成寻址。</p>
<p><img src="./assets/271.png" alt/></p>
<ul>
<li>虽然在 IP 数据报首部中有源 IP 地址，但<strong>路由器只根据目的 IP 地址进行转发</strong>。</li>
<li>在局域网的链路层，只能看见 MAC 帧。IP 数据报被封装在 MAC 帧中。通过路由器转发时，IP 数据报在每个网络中都被路由器解封装和重新封装，其<span class="text-highlight">MAC 帧首部中的源地址和目的地址会不断改变</span>。这也决定了<strong>无法使用 MAC 地址跨网络通信</strong>。</li>
</ul>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<p><span class="text-highlight">路由器</span>因为互连多个网络，所以它<span class="text-highlight">不仅有多个 IP 地址，而且有多个硬件地址</span>。</p>
</div>
</blockquote>
<p>寻址时，每个路由器依据其路由表（依靠路由协议生成）选择到目标网络（即主机号全为 0 的网络地址）需要转发到的下一跳（路由器的物理端口号或下一网络地址），而 IP 数据报通过多次路由转发到达目标网络后；改为在目标局域网中通过数据链路层的 MAC 地址以广播方式寻址。这样可以提高路由选择的效率。</p>
<h3 id="地址解析协议">地址解析协议<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#地址解析协议" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>无论网络层使用什么协议，在实际网络的链路上传送数据帧时，最终必须使用硬件地址。所以需要一种方法来完成 IP 地址到 MAC 地址的映射，这就是<strong>地址解析协议(Address Resolution Protocol, ARP)</strong>。</p>
<p>每台主机都设有一个<strong>ARP 高速缓存</strong>，用来存放本局域网上各主机和路由器的<strong>IP 地址到 MAC 地址的映射表</strong>，称 <strong>ARP 表</strong>。使用 ARP 来动态维护 ARP 表。</p>
<p><img src="./assets/272.png" alt/></p>
<p><span class="text-highlight">ARP 工作在网络层</span>，其工作原理如下：</p>
<ol>
<li>
<p>主机 A 欲向本局域网上的某台主机 B 发送 IP 数据报时，先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址。</p>
<ul>
<li>若有，则可以查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，然后通过局域网将该 MAC 帧发往此硬件地址。</li>
<li>若没有，则通过使用<span class="text-highlight">目的 MAC 地址为 FF-FF-FF-FF-FF-FF 的帧</span>来封装并<span class="text-highlight">广播 ARP 请求分组（广播发送）</span>，使同一个局域网里的所有主机都收到此 ARP 请求。</li>
</ul>
<p><img src="./assets/273.png" alt/></p>
</li>
<li>
<p>主机 B 收到该 ARP 请求后，向主机 A 发出 <span class="text-highlight">ARP 响应分组（单播发送）</span>，分组中包含主机 B 的 IP 地址与 MAC 地址的映射关系。</p>
<p><img src="./assets/274.png" alt/></p>
</li>
<li>
<p>主机 A 收到 ARP 响应分组后就将此映射写入 ARP 缓存，然后按查询到的硬件地址发送 MAC 帧。</p>
</li>
</ol>
<p><span class="text-highlight">ARP 因为“看到了”IP 地址，所以它工作在网络层，而 NAT 路由器因为“看到了”端口，所以它工作在传输层</span>。</p>
<p><img src="./assets/275.png" alt/></p>
<p>ARP 用于<span class="text-highlight">解决同一局域网上</span>的主机或路由器的 IP 地址和硬件地址的映射问题。</p>
<p>若目的主机和源主机不在同一个局域网上，则要通过 ARP 找到本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络，剩下的工作就由下一个网络来做。</p>
<p><img src="./assets/276.png" alt/></p>
<p>使用 ARP 的 4 种典型情况：</p>
<ol>
<li>
<p>发送方是主机（H1），要把 IP 分组发送到本网络上的另一台主机（H2）。这时 H1 在网 1 用 ARP 找到目的主机 H2 的硬件地址。</p>
</li>
<li>
<p>发送方是主机（H1），要把 IP 分组发送到其他网络上的一台主机（H4）。这时 H1 用 ARP 找到与网 1 连接的路由器 R1 的硬件地址（默认网关），剩下的工作由 R1 来完成。</p>
<p>开始在 H1 和 R1 之间传送时，MAC 帧首部中的源地址是 H1 的 MAC 地址，目的地址是 L1 的硬件地址，路由器 R1 收到此 MAC 帧后，在数据链路层，要丢弃原 MAC 的首部和尾部。这时首部中的源地址和目的地址分别为 L2 和 L3 的 MAC 地址。路由器 R2 收到此帧后，再次更换 MAC 帧的首部和尾部，首部中的源地址和目的地址分别变为 L4 和 H4 的 MAC 地址。MAC 帧首部的这种变化，在上面的 IP 层中是看不见的。</p>
</li>
<li>
<p>发送方是路由器（R1），要把 IP 分组转发到与 R1 连接的网络（网 2）上的一台主机（H3）。这时 R1 在网 2 用 ARP 找到目的主机 H3 的硬件地址。</p>
</li>
<li>
<p>发送方是路由器（R1），要把 IP 分组转发到网 3 上的一台主机（H4）。这时 R1 在网 2 用 ARP 找到与网 2 连接的路由器 R2 的硬件地址，剩下的工作由 R2 来完成。</p>
</li>
</ol>
<p><img src="./assets/277.png" alt/></p>
<p>从 IP 地址到硬件地址的解析是自动进行的，主机的用户并不知道这种地址解析过程。只要主机或路由器和本网络上的另一个已知 IP 地址的主机或路由器进行通信，ARP 就自动地将这个 IP 地址解析为数据链路层所需要的硬件地址。</p>
<h2 id="网际控制报文协议icmp">网际控制报文协议(ICMP)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#网际控制报文协议icmp" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>为了有效地转发 IP 数据报和提高交付成功的机会，在网络层使用了网际控制报文协议(IntermetControl MessageProtocol, ICMP)，让<span class="text-highlight">主机或路由器</span><strong>报告差错和异常情况</strong>。</p>
<p>ICMP 报文<span class="text-highlight">被封装在 IP 数据报中发送</span>，但 ICMP 不是高层协议，而是<span class="text-highlight">网络层的协议</span>。</p>
<p>ICMP 报文有两种，即<span class="text-highlight">ICMP 差错报告报文</span>和<span class="text-highlight">ICMP 询问报文</span>。</p>
<p><img src="./assets/293.png" alt/></p>
<h3 id="差错报告报文">差错报告报文<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#差错报告报文" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>ICMP 差错报告报文用于目标主机或到目标主机路径上的路由器，向源主机报告差错和异常情况。共有以下<strong>5 种常用的类型</strong>：</p>
<ol>
<li>
<p><span class="text-highlight">终点不可达</span></p>
<p>当路由器或主机不能交付数据报时，就向源点发送终点不可达报文。</p>
<p><img src="./assets/294.png" alt/></p>
</li>
<li>
<p><span class="text-highlight">源点抑制</span></p>
<p>当路由器或主机因为<span class="text-highlight">拥塞</span>而丢弃数据报时，就向源点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢。</p>
<p><img src="./assets/295.png" alt/></p>
<p><img src="./assets/296.png" alt/></p>
</li>
<li>
<p><span class="text-highlight">时间超过</span></p>
<p>当路由器收到<span class="text-highlight">生存时间(TTL)为零</span>的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。</p>
<p><img src="./assets/297.png" alt/></p>
<p>当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，并向源点发送时间超过报文。</p>
</li>
<li>
<p><span class="text-highlight">参数问题</span></p>
<p>当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文。</p>
<p><img src="./assets/298.png" alt/></p>
</li>
<li>
<p><span class="text-highlight">改变路由（重定向）</span></p>
<p>路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器（可通过更好的路由）。</p>
<p><img src="./assets/299.png" alt/></p>
<p><img src="./assets/300.png" alt/></p>
</li>
</ol>
<p>对于以下几种情况，不应发送 ICMP 差错报告报文：</p>
<ol>
<li>对 <strong>ICMP 差错报告报文</strong>，不再发送 ICMP 差错报告报文。</li>
<li>对第一个分片的数据报片的<strong>所有后续数据报片</strong>，都不发送 ICMP 差错报告报文。</li>
<li>对具<strong>有多播地址</strong>的数据报，都不发送 ICMP 差错报告报文。</li>
<li>对具<strong>有特殊地址</strong>（如 127.0.0.0 或 0.0.0.0）的数据报，不发送 ICMP 差错报告报文。</li>
</ol>
<h3 id="询问报文">询问报文<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#询问报文" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>ICMP 询问报文常用的 2 种类型：</p>
<ul>
<li><strong>回送请求</strong>和<strong>回答报文</strong>：用来测试目的站是否可达以及了解其有关状态。</li>
<li><strong>时间戳请求</strong>和<strong>回答报文</strong>：用来进行时钟同步和测量时间。</li>
</ul>
<h3 id="icmp-应用">ICMP 应用<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#icmp-应用" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><img src="./assets/301.png" alt/></p>
<p>ICMP 的两个常见应用是<strong>分组网间探测</strong><span class="text-highlight">PING</span>（用来测试两台主机之间的连通性）和<strong>跟踪路由</strong><span class="text-highlight">Traceroute</span>（UNIX 中的名字，在 Windows 中是 Tracert，可以用来跟踪分组经过的路由）。</p>
<ul>
<li>
<p><span class="text-highlight">PING 工作在应用层</span>，使用了 ICMP<strong>回送请求和回答报文</strong>。</p>
</li>
<li>
<p><span class="text-highlight">Traceroute 工作在网络层</span>，使用了 ICMP<strong>时间超过报文</strong>。</p>
<p><img src="./assets/302.png" alt/></p>
<p><img src="./assets/303.png" alt/></p>
<p><img src="./assets/304.png" alt/></p>
</li>
</ul>
<h1 id="路由算法">路由算法<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#路由算法" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>路由选择协议的核心是路由算法，即需要何种算法来获得路由表中的各个项目。</p>
<p>路由算法的目的很简单：给定一组路由器及连接路由器的链路，路由算法要找到一条从源路由器到目的路由器的“最佳”路径。</p>
<p>通常，“最佳”路径是指具有最低费用的路径。</p>
<h2 id="静态路由与动态路由">静态路由与动态路由<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#静态路由与动态路由" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>路由器转发分组是通过路由表转发的，而路由表是通过各种算法得到的。</p>
<p>从能否随网络的通信量或拓扑自适应地进行调整变化来划分，路由算法可以分为如下两大类。</p>
<ol>
<li>
<p><span class="text-highlight">静态路由算法</span></p>
<p>指由网络管理员<strong>手工配置</strong>每一条路由。</p>
<p>静态路由算法的特点是<strong>简单和开销较小</strong>，但<strong>不能及时适应网络状态的变化</strong>，<span class="text-highlight">适用于简单的小型网络</span>。</p>
</li>
<li>
<p><span class="text-highlight">动态路由算法</span></p>
<p>根据网络流量负载和拓扑结构的变化来动态调整自身的路由表。</p>
<p>动态路由算法能较好地适应网络状态的变化，但实现复杂，开销也大，适用于<span class="text-highlight">较复杂的大网络</span>。</p>
<p>常用的动态路由算法可分为两类：<strong>距离-向量路由算法</strong>和<strong>链路状态路由算法</strong>。</p>
</li>
</ol>
<p><img src="./assets/308.png" alt/></p>
<h2 id="静态路由配置">静态路由配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#静态路由配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>静态路由配置是指用户或网络运维人员使用路由器的相关命令给路由器人工配置路由表。</p>
<p><img src="./assets/307.png" alt/></p>
<h3 id="特殊路由">特殊路由<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#特殊路由" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>路由表存在<strong>两种特殊的路由</strong>：</p>
<ol>
<li>
<p><span class="text-highlight">特定主机路由</span></p>
<p>对<span class="text-highlight">特定目的主机的 IP 地址</span>专门指明一个路由，以<strong>方便网络管理员控制和测试网络</strong>。</p>
<p>若特定主机的 IP 地址是 a.b.c.d，则转发表中对应项的目的网络是 a.b.c.d/32。/32 表示的子网掩码没有意义，但这个特殊的前缀可以用在转发表中。</p>
<p><img src="./assets/306.png" alt/></p>
</li>
<li>
<p><span class="text-highlight">默认路由</span></p>
<p>用特殊前缀<span class="text-highlight">0.0.0.0/0</span>表示默认路由，全 0 掩码和任何目的地址进行按位与运算，结果必然为全 0，即必然和前缀 0.0.0.0/0 相匹配。只要<strong>目的网络是其他网络（不在转发表中），就一律选择默认路由</strong>。</p>
<p><span class="text-highlight">默认路由通常用于路由器到互联网的路由</span>，互联网包括无数的网络集合，不可能在路由表项中一一列出，因此只能采用默认路由的方式。</p>
<p><img src="./assets/305.png" alt/></p>
</li>
</ol>
<h2 id="动态路由算法">动态路由算法<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#动态路由算法" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="距离-向量路由算法">距离-向量路由算法<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#距离-向量路由算法" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><img src="./assets/323.png" alt/></p>
<h3 id="链路状态路由算法">链路状态路由算法<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#链路状态路由算法" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>链路状态</strong>是指本路由器都<strong>和哪些路由器相邻</strong>，以及<strong>相应链路的代价</strong>。“代价”用来表示费用、距离、时延和带宽等，这些都由网络管理人员来决定。</p>
<p><img src="./assets/326.png" alt/></p>
<p>链路状态算法要求<span class="text-highlight">每个结点都具有全网拓扑结构图</span>（这个拓扑结构图在全网范围内是一致的），它们执行下列两项任务：</p>
<ul>
<li>主动测试所有相邻结点的状态；</li>
<li>定期地将链路状态传播给所有其他结点。</li>
</ul>
<p>因此每个结点都知道全网共有多少个结点、哪些结点是相连的、其代价是多少等，于是每个结点都可使用<span class="text-highlight">Dijkstra 最短路径算法</span>计算出到达其他结点的最短路径。</p>
<p>在链路状态算法中，结点每收到一个链路状态报文，便用其更新自已的网络状态“视野图”，一旦链路状态发生变化，就使用 Dijkstra 算法重新计算到达所有其他结点的最短路径。</p>
<p>因为一个结点的链路状态只涉及相邻结点的连通状态，而与整个互联网的规模并无直接关系，所以链路状态算法<span class="text-highlight">适用于大型的或路由信息变化聚敛的互联网环境</span>。</p>
<p>链路状态算法的主要优点是</p>
<ul>
<li>每个结点都使用同样的链路状态数据独立地计算路径，而不依赖中间结点的计算；</li>
<li>链路状态报文不加改变地传播，因此采用该算法易于查找故障。</li>
<li>当一个结点从所有其他结点接收到报文时，它就在本地立即计算出正确的路径，保证一步汇聚。</li>
<li>因为链路状态报文仅运载来自单个结点关于直接链路的信息，其大小与网络中的结点数目无关，所以链路状态算法比距离-向量算法有更好的规模可伸展性。</li>
<li>链路状态算法具有<span class="text-highlight">快速收敛</span>的优点，它能在网络拓扑发生变化时，立即进行路由的重新计算，并及时向其他路由器发送最新的链路状态信息，使得各路由器的链路状态表能够尽量保持一致。</li>
</ul>
<hr/>
<p>两种路由算法的比较：</p>
<ul>
<li>在距离-向量算法中，每个结点仅与它的直接邻居交谈，向它的邻居发送自己的路由表，其大小取决于网络中的结点数目，代价较大。</li>
<li>在链路状态算法中，每个结点通过广播的方式与所有其他结点交谈，但它只告诉它们与它直接相连的链路的费用。</li>
</ul>
<h1 id="路由选择协议">路由选择协议<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#路由选择协议" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>互联网采用的是自适应的、分布式路由选择协议。</p>
<p>因为互联网的规模非常大，许多联网单位不愿让外界了解自己单位网络的布局细节，所以互联网采用<span class="text-highlight">分层次的路由选择协议</span>。</p>
<p>为此，可以把整个互联网划分为许多较小的自治系统。自治系统是在单一技术管理下的一组路由器，这些路由器使用一种 AS 内部的路由选择协议和共同的度量。一个 AS 对其他 AS 表现出的是一个单一的和一致的路由选择策略。</p>
<p><img src="./assets/309.png" alt/></p>
<p>这样，互联网就把路由选择协议划分为两大类。</p>
<ul>
<li>
<p><span class="text-highlight">内部网关协议</span>(Interior Gateway Protocol, <span class="text-highlight">IGP</span>)</p>
<p>内部网关协议即在一个自治系统内部使用的路由选择协议，它与在互联网中的其他自治系统选用什么路由选择协议无关。</p>
<p>目前这类路由选择协议使用得最多，如 RIP 和 OSPF。</p>
</li>
<li>
<p><span class="text-highlight">外部网关协议</span>(External Gateway Protocol, <span class="text-highlight">EGP</span>)</p>
<p>若源主机和目的主机处在不同的自治系统中，则当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议。</p>
<p>目前使用最多的外部网关协议是 BGP-4。</p>
</li>
</ul>
<p>自治系统之间的路由选择也称域间路由选择，自治系统内部的路由选择也称域内路由选择。</p>
<p>每个自治系统自己决定在本自治系统内部运行哪个内部网关协议。但每个自治系统都有一个或多个路由器除运行本系统的内部网关协议外，还要运行外部网关协议。</p>
<p><img src="./assets/310.png" alt/></p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<ol>
<li>外部网关协议 EGP 和内部网关协议 IGP 只是路由选择协议的分类名称，而不是具体的路由选择协议。</li>
<li>外部网关协议和内部网关协议名称中使用的是“网关”这个名词，是因为在因特网早期的 RFC 文档中，没有使用“路由器”而使用的是“网关”这一名词。</li>
</ol>
</div>
</blockquote>
<h2 id="内部网关协议">内部网关协议<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#内部网关协议" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="路由信息协议rip">路由信息协议(RIP)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#路由信息协议rip" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>路由信息协议(Routing Information Protocol, <span class="text-highlight">RIP</span>)是内部网关协议 IGP 中最先得到广泛应用的协议。RIP 是一种分布式的<span class="text-highlight">基于距离向量的</span>路由选择协议。</p>
<h4 id="规定">规定<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#规定" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>
<p>网络中的每个路由器都要维护从它自身到其他每个目的网络的距离记录，即距离向量。</p>
</li>
<li>
<p>RIP 使用<span class="text-highlight">跳数</span>(Hop Count)来衡量到达目的网络的距离。</p>
<p>规定从一路由器到<strong>直接连接的网络的距离定义为 1</strong>；而<strong>每经过一个路由器</strong>，距离就加 1。</p>
<p>RIP 允许<span class="text-highlight">一条路径最多只能包含 15 个路由器</span>。因此<strong>距离等于 16 时表示网络不可达</strong>。可见 RIP 只适用于小型互联网。</p>
<p><img src="./assets/311.png" alt/></p>
<p>距离向量路由可能会出现环路的情况，规定路径上的<strong>最高跳数的目的是为了防止分组不断在环路上循环，减少网络拥塞的可能性</strong>。</p>
</li>
<li>
<p>RIP 认为<span class="text-highlight">好的路由</span>就是它<span class="text-highlight">通过的路由器数目少</span>，即距离短或跳数少。</p>
<p><img src="./assets/312.png" alt/></p>
</li>
<li>
<p>每个路由表项都有三个关键字段：目的网络，距离，下一跳路由器地址。</p>
</li>
</ol>
<h4 id="特点-1">特点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#特点-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>RIP 的每个路由器都要不断与其他路由器交换信息，下面三个特点非常重要。</p>
<ol>
<li>
<p><strong>和谁交换信息</strong></p>
<p><span class="text-highlight">仅和直接相邻的路由器</span>交换信息。</p>
<p><img src="./assets/313.png" alt/></p>
</li>
<li>
<p><strong>交换什么信息</strong></p>
<p>交换的信息是本路由器所知道的全部信息，即自己的<span class="text-highlight">路由表</span>。</p>
</li>
<li>
<p><strong>何时交换信息</strong></p>
<p>按<span class="text-highlight">固定的时间间隔</span>（如 30 秒）交换路由信息。当<span class="text-highlight">网络拓扑发生变化时</span>，路由器也及时向相邻路由器通告拓扑变化后的路由信息。</p>
</li>
</ol>
<h4 id="基本工作过程">基本工作过程<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#基本工作过程" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>路由器刚开始工作时，只知道自己到直接相连的几个网络的距离为 1。</p>
<p>每个路由器仅和相邻路由器周期性地交换并更新路由信息。</p>
<p>所谓<span class="text-highlight">收敛</span>，是指当路由环境发生变化后，各<strong>路由器调整自己的路由表以适应网络拓扑结构的变化</strong>，最终<strong>达到稳定状态</strong>（路由表与网络拓扑状态保持一致）。<strong>收敛越快，路由器就能越快适应网络拓扑结构的变化</strong>。</p>
<p><img src="./assets/314.png" alt/></p>
<p><img src="./assets/315.png" alt/></p>
<h4 id="距离向量算法">距离向量算法<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#距离向量算法" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><img src="./assets/316.png" alt/></p>
<p><img src="./assets/317.png" alt/></p>
<p><img src="./assets/318.png" alt/></p>
<p><img src="./assets/319.png" alt/></p>
<p><img src="./assets/320.png" alt/></p>
<p><img src="./assets/321.png" alt/></p>
<p><img src="./assets/322.png" alt/></p>
<p>若 180 秒（RIP 默认超时时间）还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达的路由器，即把距离设置为 16（距离为 16 表示不可达）。</p>
<h4 id="优缺点">优缺点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#优缺点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><img src="./assets/325.png" alt/></p>
<hr/>
<p>优点：</p>
<ol>
<li><strong>实现简单、开销小、收敛过程较快</strong>。</li>
<li>若一个路由器发现了更短的路由，则这种更新信息就传播得很快，在较短时间内便可被传至所有路由器，俗称“<span class="text-highlight">好消息传播得快</span>”。</li>
</ol>
<p>缺点：</p>
<ol>
<li>
<p>RIP 限制了网络的规模，它能使用的<strong>最大距离为 15</strong>（16 表示不可达）。因此若是某个自治系统内任意两台主机通信时经过的路由器数量可能超过15个，那就不能使用 RIP 协议，该考虑使用 OSPF 协议。</p>
</li>
<li>
<p>路由器之间<strong>交换</strong>的是路由器中的<strong>完整路由表</strong>，因此<strong>网络规模越大，开销也越大</strong>。</p>
</li>
<li>
<p>当网络出现故障时，路由器之间需反复多次交换信息才能完成收敛，要经过较长时间才能将故障消息传送到所有路由器（即慢收敛现象），俗称“<span class="text-highlight">坏消息传播得慢</span>”。</p>
<p><img src="./assets/324.png" alt/></p>
</li>
</ol>
<h3 id="开放最短路径优先协议ospf">开放最短路径优先协议(OSPF)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#开放最短路径优先协议ospf" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>开放最短路径优先(Open Shortest Path First, OSPF)协议是<span class="text-highlight">使用分布式链路状态路由算法</span>的典型代表，也是内部网关协议(IGP)的一种。</p>
<h4 id="特点-2">特点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#特点-2" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>
<p>OSPF 向本自治系统中<span class="text-highlight">所有路由器发送信息</span>。</p>
<p>而 RIP 仅仅向自己<strong>相邻的</strong>几个路由器发送信息。</p>
</li>
<li>
<p>发送的信息是<span class="text-highlight">与本路由器相邻的所有路由器的链路状态</span>，但这只是<strong>路由表的一部分</strong>。</p>
<p>而<strong>在 RIP 中</strong>，发送的信息是本路由器所知道的全部信息，即<strong>整个路由表</strong>。</p>
</li>
<li>
<p><span class="text-highlight">只有当链路状态发生变化时</span>，路由器才用洪泛法向所有路由器发送此信息，并且更新过程收敛得快，不会出现 RIP“坏消息传得慢”的问题。</p>
<p>而在 RIP 中，不管网络拓扑是否发生变化，路由器之间都要<strong>定期</strong>交换路由表的信息。</p>
</li>
<li>
<p><span class="text-highlight">OSPF 是网络层协议</span>，它不用 UDP 或 TCP，而<span class="text-highlight">直接用 IP 数据报</span>传送（其 IP 数据报首部的协议字段为 89）。</p>
<p>而<span class="text-highlight">RIP 是应用层协议</span>（但其核心功能是路由选择，属于网际层），它<span class="text-highlight">在传输层使用 UDP</span>。</p>
<p>用 UDP 传送是指将该信息作为 UDP 报文的数据部分，而直接使用 IP 数据报传送是指将该信息直接作为 IP 数据报的数据部分。RIP 报文是作为 UDP 数据报的数据部分。</p>
</li>
<li>
<p>OSPF 允许对每条路由设置成不同的代价，对于不同类型的业务可计算出不同的路由。</p>
</li>
<li>
<p>若到同一个目的网络有多条相同代价的路径，则可将通信量分配给这几条路径。</p>
</li>
<li>
<p>OSPF 分组具有鉴别功能，从而保证仅在可信赖的路由器之间交换链路状态信息。</p>
</li>
<li>
<p>OSPF 支持可变长度的子网划分和无分类编址 CIDR。</p>
</li>
<li>
<p>每个链路状态都带上一个 32 位的序号，序号越大，状态就越新。</p>
</li>
</ol>
<h4 id="工作原理">工作原理<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#工作原理" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>因为各路由器之间频繁地交换链路状态信息，所以所有路由器最终都能建立一个链路状态数据库，即全网的拓扑结构图。然后，每个路由器利用链路状态数据库中的数据，使用 Dijkstra 算法计算自己到达各目的网络的最优路径，构造出自已的路由表。此后，当链路状态发生变化时，每个路由器重新计算到达各目的网络的最优路径，构造出新的路由表。</p>
<blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Tip</p></div>
                  
                </div>
<div class="callout-content">
<p>虽然使用 Dijkstra 算法能计算出完整的最优路径，但<span class="text-highlight">路由表中不会存储完整路径，而只存储“下一跳”</span>（只有到了下一跳路由器，才能知道再下一跳应当怎样走）。</p>
</div>
</blockquote>
<p>为了使 OSPF<strong>能够用于规模很大的网络</strong>，OSPF<strong>将一个自治系统再划分为若干更小的范围，称为区域</strong>。域之间通过区域边界路由器互连。</p>
<p><strong>划分区域的好处是</strong>，将<strong>利用洪泛法交换链路状态信息的范围局限在每个区域而非整个自治系统</strong>，从而<strong>减少了整个网络上的通信量</strong>。</p>
<p><img src="./assets/329.png" alt/></p>
<p>OSPF 协议将一个自治域划分成若干域，有一种特殊的域称为主干区域。主干区域中，用于连接主干区域和其他下层区域的路由器称为区域边界路由器。只要是在主干区域中的路由器，就都称为主干路由器，因此主干路由器可以兼作区域边界路由器。</p>
<h4 id="工作过程">工作过程<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#工作过程" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>OSPF 共有以下五种分组类型：</p>
<ol>
<li><strong>问候分组</strong>：用来发现和维持邻站的可达性。</li>
<li><strong>数据库描述分组</strong>：向邻站给出自已的链路状态数据库中的所有链路状态项目的摘要信息。</li>
<li><strong>链路状态请求分组</strong>：向对方请求发送某些链路状态项目的详细信息。</li>
<li><strong>链路状态更新分组</strong>：用洪泛法对全网更新链路状态，它是 OSPF 最核心的部分。</li>
<li><strong>链路状态确认分组</strong>：对链路更新分组的确认。</li>
</ol>
<p><img src="./assets/327.png" alt/></p>
<p>在网络中通常传送的 OSPF 分组大多是问候分组。两个相邻路由器通常每隔 10 秒要交换一次问候分组，以便知道哪些站可达。若有 40 秒没有收到某个相邻路由器发来的问候分组，则认为该相邻路由器不可达，应立即修改链路状态数据库，并重新计算路由表。</p>
<p><img src="./assets/328.png" alt/></p>
<p>在路由器刚开始工作时，OSPF 让每个路由器使用数据库描述分组和相邻路由器交换本数据库中已有的链路状态摘要信息。然后，路由器使用链路状态请求分组，向对方请求发送自已所缺少的某些链路状态项目的详细信息。经过一系列的这种分组交换，就建立了全网同步的链路数据库。</p>
<p>在网络运行的过程中，只要一个路由器的链路状态发生变化，该路由器就要使用链路状态更新分组，用洪泛法向全网更新链路状态。其他路由器在收到更新分组后要发送确认。</p>
<p>为了确保链路状态数据库与全网的状态保持一致，OSPF 还规定每隔一段时间（如 30 分钟）要刷新一次数据库中的链路状态。因为一个路由器的链路状态只涉及与相邻路由器的连通状态，与整个网络的规模并无直接关系，所以<span class="text-highlight">当互联网规模很大时，OSPF 要比 RIP 好得多</span>。</p>
<h2 id="外部网关协议">外部网关协议<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#外部网关协议" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="边界网关协议bgp">边界网关协议(BGP)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#边界网关协议bgp" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="概念">概念<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#概念" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>边界网关协议(BorderGatewayProtocol, BGP)是不同自治系统 AS 的路由器之间交换路由信息的协议，是一种外部网关协议。边界网关协议 BGP 常用于互联网的网关之间。</p>
<p>内部网关协议主要是设法使数据报在一个 AS 中尽可能有效地从源站传送到目的站。在一个 AS 内部也不需要考虑其他方面的策略。然而 BGP 使用的环境却不同，主要原因如下：</p>
<ol>
<li>
<p>互联网的规模太大，使得 AS 之间路由选择非常困难，每个主干网路由器表中的项目数都非常庞大。对于 AS 之间的路由选择，要寻找最佳路由是很不现实的。</p>
<p><img src="./assets/330.png" alt/></p>
</li>
<li>
<p>AS 之间的路由选择必须考虑政治、安全或经济等有关因素。</p>
<p><img src="./assets/331.png" alt/></p>
</li>
</ol>
<p>自治系统之间的路由选择协议应当允许使用多种路由选择策略。这些策略包括政治、经济、安全等，它们都是由网络管理人员对每一个路由器进行设置的。但这些策略并不是自治系统之间的路由选择协议本身。</p>
<p>BGP 只能是<strong>力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子）</strong>，而<span class="text-highlight">并非要寻找一条最佳路由</span>。</p>
<p>BGP 采用的是<span class="text-highlight">路径向量路由选择协议</span>，它与距离向量协议（如 RIP）和链路状态协议（如 OSPF）都有很大的区别。</p>
<p><span class="text-highlight">BGP 是应用层协议</span>，它是<span class="text-highlight">基于 TCP 的</span>。</p>
<h4 id="工作原理-1">工作原理<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#工作原理-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>
<p>配置 BGP 时，每个 AS 的管理员要<strong>选择至少一个路由器</strong>，作为该 AS 的“<span class="text-highlight">BGP 发言人</span>”，<strong>BGP 发言人往往就是 BGP 边界路由器</strong>。</p>
<p><img src="./assets/332.png" alt/></p>
</li>
<li>
<p>一个 BGP 发言人与其他 AS 中的 BGP 发言人要交换路由信息，就要<strong>先建立 TCP 连接</strong>，然后在此连接上交换 BGP 报文以<strong>建立 BGP 会话</strong>，再利用 BGP 会话<strong>交换路由信息</strong>。</p>
<p>使用 TCP 连接交换路由信息的两个 BGP 发言人，彼此成为对方的<span class="text-highlight">邻站</span>或<span class="text-highlight">对等站</span>。</p>
<p>每个 BGP 发言人除了必须运行 BGP 外，还必须运行该 AS 所用的内部网关协议，如 OSPF 或 RIP。</p>
<p><img src="./assets/333.png" alt/></p>
</li>
<li>
<p>BGP 所交换的<span class="text-highlight">网络可达性信息</span>，就是要<strong>到达某个网络所要经过的一系列自治系统</strong>，即<strong>到达某个网络所经过的路径</strong>。当 BGP 发言人互相交换网络可达性信息后，各 BGP 发言人就根据所用的策略，从收到的路由信息中找出到达各自治系统的较好路由。</p>
<p><img src="./assets/334.png" alt/></p>
<p><img src="./assets/335.png" alt/></p>
</li>
</ol>
<h4 id="特点-3">特点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#特点-3" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>BGP 交换路由信息的结点数量级是 AS 个数的数量级，这要比这些 AS 中的网络数少很多。</li>
<li>寻找一条较好的路径，取决于找准正确的 BGP 发言人，而每个 AS 中 BGP 发言人（或边界路由器）的数目是很少的。这样就使得 AS 之间的路由选择不致过分复杂。</li>
<li>BGP 支持 CIDR，因此 BGP 的路由表也就应当包括目的网络前缀、下一跳路由器，以及到达该目的网络所要经过的各个自治系统序列。</li>
<li>当 BGP 刚运行时，BGP 的邻站交换整个 BGP 路由表。但以后只需要在发生变化时更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销方面都有好处。</li>
</ol>
<h4 id="报文">报文<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#报文" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li><strong>打开报文</strong>：用来与相邻的另一个 BGP 发言人建立关系，使通信初始化。</li>
<li><strong>更新报文</strong>：用来通知某一路由的信息，以及列出要撤销的多条路由。</li>
<li><strong>保活报文</strong>：用来周期性地证实邻站的连通性。</li>
<li><strong>通知报文</strong>：用来发送检测到的差错。</li>
</ol>
<p><img src="./assets/336.png" alt/></p>
<p>若一个 BGP 发言人想与另一个 AS 的 BGP 发言人建立邻站关系，则要向对方发送 Open 报文，若对方接受这种邻站关系，则用 Keepalive 报文响应。</p>
<p>邻站关系一旦建立，就要继续维持这种关系。为此，这两个 BGP 发言人彼此要周期性地交换 Keepalive 报文（一般每隔 30 秒）。Keepalive 报文只有 19B，因此不会造成网络上太大的开销。</p>
<p>Update 报文是 BGP 的核心内容，BGP 发言人可以用 Update 报文撤销它曾经通知过的路由，也可以宣布增加新的路由。</p>
<h2 id="三种路由协议比较">三种路由协议比较<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#三种路由协议比较" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>从实现功能（路由选择）的角度看，这三个路由选择协议都属于网络层。</p>
<p>从数据包按网络体系结构逐层封装的角度看，RIP 和 BGP 属于应用层，OSPF 属于网络层。</p>
<p><img src="./assets/338.png" alt/></p>
<p><img src="./assets/337.png" alt/></p>
<h1 id="ip-多播">IP 多播<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ip-多播" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<h2 id="概念-1">概念<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#概念-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>多播是让源主机一次发送的单个分组可以抵达用一个组地址标识的若干目的主机，即<span class="text-highlight">一对多的通信</span>。在互联网上进行的多播，称为 IP 多播。</p>
<p>与单播相比，在一对多的通信中，多播可大大<span class="text-highlight">节约网络资源</span>。</p>
<p>多播需要路由器的支持才能实现，能够运行多播协议的路由器称为多播路由器。</p>
<p><img src="./assets/347.png" alt/></p>
<h2 id="多播地址">多播地址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#多播地址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>多播数据报的<span class="text-highlight">源地址</span>是<span class="text-highlight">源主机的 IP 地址</span>，<span class="text-highlight">目的地址</span>是<span class="text-highlight">IP 多播地址</span>。IP 多播地址就是 IPv4 中的 <span class="text-highlight">D 类地址</span>。每个 D 类 IP 地址标志一个多播组，<strong>一台主机可以随时加入或离开一个多播组</strong>。</p>
<p><img src="./assets/348.png" alt/></p>
<p>多播数据报和一般的 IP 数据报的区别是，前者使用 D 类 IP 地址作为目的地址，并且首部中的协议字段值是 2，表明使用 IGMP 协议。</p>
<p>需要注意的是：</p>
<ol>
<li>多播数据报也是“尽最大努力交付”，不提供可靠交付。</li>
<li>多播地址只能用于目的地址，而不能用于源地址。</li>
<li>对多播数据报不产生 ICMP 差错报文。</li>
</ol>
<p>IP 多播可以分为两种：</p>
<ol>
<li>只在<strong>本局域网</strong>上进行<strong>硬件多播</strong>；</li>
<li>在<strong>互联网</strong>的范围内进行<strong>多播</strong>。</li>
</ol>
<p>目前大部分主机都是通过局域网接入互联网的。因此，在互联网上进行<strong>多播的最后阶段，还是要把多播数据报在局域网上用硬件多播交付给多播组的所有成员</strong>。</p>
<p>多播机制仅应用于 UDP，它能将报文同时发送给多个接收者。而 TCP 是一个面向连接的协议，它意味着分别运行在两台主机的进程之间存在一条连接，因此会一对一地发送。</p>
<h2 id="硬件多播">硬件多播<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#硬件多播" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>由于 MAC 地址（也称为硬件地址）有多播 MAC 地址这种类型，因此只要把<strong>IP 多播地址映射成多播 MAC 地址</strong>，即可将 IP 多播数据报封装在局域网的 MAC 帧中，而 MAC 帧首部中的目的 MAC 地址字段的值，就设置为由 IPv4 多播地址映射成的多播 MAC 地址。这样，可以很方便地<strong>利用硬件多播来实现局域网内的 IP 多播</strong>。</p>
<p><img src="./assets/349.png" alt/></p>
<p>因特网号码指派管理局 IANA，将 01-00-5E-00-00-00 到 01-00-5E-7F-FF-FF 的多播 MAC 地址，用于映射 IPv4 多播地址。</p>
<p><img src="./assets/350.png" alt/></p>
<p><img src="./assets/351.png" alt/></p>
<p><img src="./assets/352.png" alt/></p>
<p><img src="./assets/354.png" alt/></p>
<p><img src="./assets/353.png" alt/></p>
<h2 id="网际组管理协议igmp">网际组管理协议(IGMP)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#网际组管理协议igmp" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>路由器要获得多播组的成员信息，需要利用网际组管理协议(InternetGroupManagementProtocol，IGMP)。</p>
<p>IGMP 是让连接到本地局域网上的多播路由器，<strong>知道本局域网上是否有主机参加或退出了某个多播组</strong>。IGMP 并不是在互联网范围内对所有多播组成员进行管理的协议。IGMP 不知道 IP 多播组包含的成员数，也不知道这些成员分布在哪些网络上。</p>
<p>IGMP 报文被封装在 IP 数据报中传送，但它也向 IP 提供服务。因此不把 IGMP 视为一个单独的协议，而视为整个网际协议 IP 的一个组成部分。IGMP 的工作可分为两个阶段。</p>
<p>第一阶段：当某台主机加入新的多播组时，该主机应向多播组的多播地址发送一个 IGMP 报文，声明自己要成为该组的成员。本地的多播路由器收到 IGMP 报文后，还要利用多播路由选择协议，把这种组成员关系转发给互联网上的其他多播路由器。第二阶段：组成员关系是动态的。本地多播路由器要周期性地探询本地局域网上的主机，以便知道这些主机是否仍继续是组的成员。只要对某个组有一台主机响应，多播路由器就认为这个组是活跃的。但一个组在经过几次探询后仍然没有一台主机响应，多播路由器就认为本网络上的主机都已离开了这个组，因此就不再把这个组的成员关系转发给其他的多播路由器。</p>
<h2 id="多播路由选择协议">多播路由选择协议<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#多播路由选择协议" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>仅使用 IGMP 并不能在因特网上进行 IP 多播。连接在局域网上的多播路由器还必须和因特网上的其他多播路由器协同工作，以便把 IP 多播数据报用最小的代价传送给所有的多播组成员，这就需要使用多播路由选择协议。</p>
<p>多播路由选择实际上就是要<strong>找出以源主机为根结点的多播转发树，其中每个分组在每条链路上只传送一次</strong>（即在多播转发树上的路由器不会收到重复的多播数据报）。</p>
<p><img src="./assets/355.png" alt/></p>
<p>不同的多播组对应于不同的多播转发树；同一个多播组，对不同的源点也会有不同的多播转发树。</p>
<h1 id="移动-ip">移动 IP<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#移动-ip" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>移动 IP 技术是指<strong>移动站以固定的 IP 地址实现跨越不同网络的漫游功能</strong>，并保证基于 IP 的网络权限在漫游过程中不发生任何改变。</p>
<p>移动 IP 的目标是把分组自动地投递给移动站。一个移动站是把其连接点从一个网络或子网改变到另一个网络或子网的主机。</p>
<p>移动 IP 定义了三种功能实体：</p>
<ol>
<li><strong>移动结点</strong>：具有永久 IP 地址的移动主机。</li>
<li><strong>本地代理</strong>：也称<strong>归属代理</strong>，通常就是连接在归属网络（原始连接到的网络）上的路由器。</li>
<li><strong>外地代理</strong>：通常就是连接在被访网络（移动到另一地点所接入的网络）上的路由器。</li>
</ol>
<p>值得注意的是，某用户将笔记本关机后从家里带到办公室重新上网，在办公室能很方便地通过 DHCP 自动获取新的 IP 地址。虽然笔记本移动了，更换了地点及所接入的网络，但这并不是移动 IP。</p>
<p>但是，若我们需要在移动中进行 TCP 传输，则在移动站漫游时，应一直保持这个 TCP 连接，否则移动站的 TCP 连接就会断断续续。可见，若要使移动站在移动中的 TCP 连接不中断，就必须使笔记本的 IP 地址在移动中保持不变。这就是移动 IP 要研究的问题。</p>
<hr/>
<p>在移动 IP 中，每个移动站都有一个原始地址，即永久地址（或归属地址），移动站原始连接的网络称为归属网络。永久地址和归属网络的关联是不变的。</p>
<p>归属代理通常是连接到归属网络上的路由器，然而它实现的代理功能是在应用层完成的。当移动站移动到另一地点，所接入的外地网络也称被访网络。被访网络中使用的代理称为外地代理，它通常是连接在被访网络上的路由器。</p>
<p>外地代理有两个重要功能：</p>
<ul>
<li>要为移动站创建一个临时地址，称为转交地址。转交地址的网络号显然和被访网络一致。</li>
<li>及时把移动站的转交地址告诉其归属代理。</li>
</ul>
<hr/>
<p>移动 IP 的基本通信流程如下：</p>
<ol>
<li>
<p>移动站 A 在归属网络时，按传统的 TCP/IP 方式进行通信。</p>
</li>
<li>
<p>移动站 A 漫游到被访网络时，向外地代理进行登记，以获得一个临时的转交地址。外地代理要向 A 的归属代理登记 A 的转交地址。</p>
<p><img src="./assets/356.png" alt/></p>
<p><img src="./assets/357.png" alt/></p>
</li>
<li>
<p>归属代理知道移动站 A 的转交地址后，会构建一条通向转交地址的隧道，将截获的发送给 A 的 IP 分组进行再封装，并通过隧道发送给被访网络的外地代理。</p>
<p><img src="./assets/358.png" alt/></p>
</li>
<li>
<p>外地代理把收到的封装的 IP 分组进行拆封，恢复成原始的 IP 分组，然后发送给移动站 A，这样 A 在被访网络就能收到这些发送给它的 IP 分组。</p>
<p><img src="./assets/359.png" alt/></p>
</li>
<li>
<p>移动站 A 在被访网络对外发送 IP 分组时，仍然使用自己的永久地址作为 IP 分组的源地址，此时显然无须通过 A 的归属代理来转发，而是直接通过被访网络的外部代理。</p>
<p><img src="./assets/360.png" alt/></p>
</li>
<li>
<p>移动站 A 移动到另一被访网络时，在新外地代理登记后，然后新外地代理将 A 的新转交地址告诉其归属代理。无论如何移动，A 收到的 IP 分组都是由归属代理转发的。</p>
</li>
<li>
<p>移动站 A 回到归属网络时，A 向归属代理注销转交地址。</p>
</li>
</ol>
<hr/>
<p>为了支持移动性，在网络层中还应增加一些新功能：</p>
<ul>
<li>移动站到外地代理的登记协议；</li>
<li>外地代理到归属代理的登记协议；</li>
<li>归属代理数据报封装协议；</li>
<li>外地代理拆封协议。</li>
</ul>
<p>所有使用同一外地代理的移动主机都可以共享同一个转交地址。</p>
<h1 id="ipv6">IPV6<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ipv6" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>为了解决“IP 地址耗尽”问题，有以下三种措施：</p>
<ol>
<li>采用无类别编址 CIDR，使 IP 地址的分配更加合理。</li>
<li>采用网络地址转换（NAT）方法以节省全球 IP 地址。</li>
<li>采用具有更大地址空间的新版本的 IPv6。</li>
</ol>
<p>前两种方法只是延长了 IPv4 使用寿命，只有第三种方法能从根本上解决 IP 地址耗尽问题。</p>
<h2 id="特点-4">特点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#特点-4" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>
<p>更大的地址空间。IPv6 将地址从 IPv4 的 32 位增大到 <span class="text-highlight">128 位</span>，IPv6 的地址空间是 IPv4 的 2^96^ 倍。</p>
</li>
<li>
<p>扩展的地址层次结构。IPv6 因为地址空间很大，所以可以划分为更多的层次。</p>
</li>
<li>
<p>灵活的首部格式。IPv6 定义了许多可选的扩展首部，不仅可提供比 IPv4 更多的功能，而且能提高路由器的处理效率，这是因为路由器对扩展首部不进行处理。</p>
</li>
<li>
<p>改进的选项。IPv6 首部长度是固定的，其选项放在有效载荷中，选项是灵活可变的。而 IPv4 所规定的选项是固定不变的，其选项放在首部的可变部分。</p>
</li>
<li>
<p>允许协议继续扩充。IPv6 允许不断扩充功能，而 IPv4 的功能是固定不变的。</p>
</li>
<li>
<p>支持即插即用（即自动配置）。因此 IPv6 <span class="text-highlight">不需要使用 DHCP</span>。</p>
</li>
<li>
<p>支持资源的预分配。</p>
</li>
<li>
<p><span class="text-highlight">IPv6 中不充许分片</span>。IPv6 <span class="text-highlight">只有源主机才能分片</span>，是端到端的，<span class="text-highlight">不允许</span>类似 IPv4 传输路径中的<span class="text-highlight">路由分片</span>。因此，若一个路由器收到的 IPv6 数据报因太大而不能转发到链路上，则<span class="text-highlight">丢弃</span>该数据报，并向发送方发送一个指示分组太大的 ICMP 报文。</p>
</li>
<li>
<p>IPv6 <span class="text-highlight">首部长度是固定的 40B</span>，而 IPv4 首部长度是可变的（必须是 4B 的整数倍）。</p>
</li>
<li>
<p>增大了安全性</p>
</li>
</ol>
<p><img src="./assets/361.png" alt/></p>
<p>虽然 IPv6 与 IPv4 不兼容，但总体而言它与所有其他的互联网协议兼容，包括 TCP、UDP、ICMP、IGMP 和 DNS 等，只是在少数地方做了必要的修改（大部分是为了处理长地址）。</p>
<h2 id="ipv6-数据报">IPV6 数据报<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ipv6-数据报" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p><img src="./assets/362.png" alt/></p>
<p>IPv6 将 IPv4 数据报首部中不必要的功能取消了，这使得 IPv6 数据报基本首部中的字段数量减少到只有 8 个。但由于 IPv6 地址的长度扩展到了 128 比特，因此使得 IPv6 数据报基本首部的长度反而增大到了 40 字节，比 IPv4 数据报首部固定部分的长度（20 字节）增大了 20 字节。</p>
<p><img src="./assets/363.png" alt/></p>
<ol>
<li>
<p>版本：占<strong>4 位</strong>，指明协议的版本，对于 IPv6 该字段的值是 6。</p>
</li>
<li>
<p>通信量类：占<strong>8 位</strong>，用来<strong>区分不同的 IPv6 数据报的类别或优先级</strong>。</p>
</li>
<li>
<p>流标号：占 2<strong>0 位</strong>，IPv6 提出流的抽象概念。流是指互联网上从特定源点到特定终点（单播或多播）的<strong>一系列数据报</strong>（如实时音/视频传输），而在这个“流”所经过的路径上的路由器都保证指明的服务质量。所有<strong>属于同一个流的数据报都具有相同的流标号</strong>。</p>
</li>
<li>
<p>有效载荷长度：占 <strong>16 位</strong>，指明 IPv6 数据报<strong>除基本首部以外的字节数</strong>（所有扩展首部都算在有效载荷之内）。这个字段的<strong>最大值是 65535 字节</strong>。</p>
</li>
<li>
<p>下一个首部：占 <strong>8 位</strong>，该字段相当于 IPv4 首部中的协议字段或可选字段。</p>
<p>当 IPv6 <strong>没有扩展首部时</strong>，其作用与 IPv4 的协议字段一样，它指明 IPv6 数据报所<strong>运载的数据是何种协议数据单元</strong>；</p>
<p><img src="./assets/364.png" alt/></p>
<p>当 IPv6 <strong>带有扩展首部时</strong>，它就<strong>标识后面第一个扩展首部的类型</strong>。</p>
<p><img src="./assets/365.png" alt/></p>
</li>
<li>
<p><span class="text-highlight">跳数限制(Hop Limit)</span>：占 <strong>8 位</strong>，类似于 IPv4 首部的 TTL 字段。源点在每个数据报发出时即设定某个限制值（最大为 255）。路由器每次转发时将其值减 1，减为零时就将该数据报丢弃。</p>
<blockquote>
<p>该字段的作用<span class="text-highlight">与 IPv4 数据报首部中的生存时间 TTL 字段完全一样</span>。</p>
</blockquote>
</li>
<li>
<p><span class="text-highlight">源地址和目的地址</span>：占 <strong>128 位</strong>，是数据报的发送端/接收端的 IP 地址。</p>
</li>
</ol>
<h2 id="ipv6-地址">IPV6 地址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ipv6-地址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="表示方法-1">表示方法<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#表示方法-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>IPv4 地址通常使用点分十进制表示法。若 IPv6 也使用这种表示法，则地址书写起来将相当长。IPv6 标准使用冒号十六进制记法，即把地址中的每 4 位用一个十六进制数表示，并用冒号分隔每 16 位。</p>
<p><img src="./assets/366.png" alt/></p>
<p>在 IPv6 地址的冒号十六进制记法的基础上，再使用<span class="text-highlight">“左侧零”省略</span>和<span class="text-highlight">“连续零”压缩</span>，可使 IPv6 地址的表示更加简洁。</p>
<ul>
<li>“左侧零”省略是指两个冒号间的十六进制数中最前面的一串 0 可以省略不写。</li>
<li>“连续零”压缩是指一连串连续的 0 可以用一对冒号取代。</li>
</ul>
<p><img src="./assets/367.png" alt/></p>
<p>在<span class="text-highlight">一个 IPv6 地址中只能使用一次“连续零”压缩</span>，否则会导致歧义。</p>
<p><img src="./assets/368.png" alt/></p>
<p>冒号十六进制记法还可<strong>结合点分十进制的后缀</strong>。这在 IPv4 向 IPv6 过渡阶段非常有用。</p>
<p><img src="./assets/369.png" alt/></p>
<p>CIDR 的斜线表示法在 IPv6 中仍然可用。</p>
<p><img src="./assets/370.png" alt/></p>
<h3 id="分类">分类<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#分类" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>IPv6 数据报的目的地址有以下三种基本类型：</p>
<ul>
<li>单播：就是传统的点对点通信。</li>
<li>多播：一点对多点的通信，数据报发送到一组计算机中的每一台。</li>
<li>任播：这是 IPv6 增加的一种类型。任播的终点是一组计算机，但数据报只交付其中的一台计算机，通常是距离最近的一台计算机。</li>
</ul>
<p><img src="./assets/371.png" alt/></p>
<p><img src="./assets/372.png" alt/></p>
<ol>
<li>
<p><strong>未指明地址</strong>：该地址不能用作目的地址，只能用于还未配置 IPv6 地址的主机作为源地址。</p>
</li>
<li>
<p><strong>环回地址</strong>：该地址的作用与 IPv4 的环回地址相同，但 IPv6 的环回地址仅此一个。</p>
</li>
<li>
<p><strong>多播地址</strong>：该地址的作用和 IPv4 的一样。这类地址占 IPv6 地址空间的 1/256。</p>
</li>
<li>
<p><strong>本地链路单播地址</strong>：该地址的作用类似于 IPv4 的私有 IP 地址。</p>
</li>
<li>
<p><strong>全球单播地址</strong>：用得最多的地址。IPv6 全球单播地址采用三级结构：</p>
<ul>
<li>第一级为全球路由选择前缀，占 48 位，用于互联网中的路由选择，相当于 IPv4 分类地址中的网络号；</li>
<li>第二级为子网标识符，占 16 位，用于各机构构建自己的子网：</li>
<li>第三级为接口标识符，用于指明主机或路由器的单个网络接口，相当于 IPv4 分类地址中的主机号。</li>
</ul>
<p><img src="./assets/373.png" alt/></p>
</li>
</ol>
<h2 id="ipv4-向-ipv6-过渡">IPv4 向 IPv6 过渡<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ipv4-向-ipv6-过渡" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>从 IPv4 向 IPv6 过渡只能<strong>采用逐步演进的办法</strong>，同时还必须使新安装的 <strong>IPv6 系统能够向后兼容</strong>。IPv6 系统必须能够接收和转发 IPv4 分组，并且能够为 IPv4 分组选择路由。</p>
<p>从 IPv4 向 IPv6 过渡可以采用下列两种策略：</p>
<ol>
<li>
<p><strong>双协议栈</strong></p>
<p>指在一台设备上同时装有 IPv4 和 IPv6 两个协议栈，分别配置了一个 IPv4 地址和一个 IPv6 地址，因此这台设备既能和 IPv4 网络通信，又能和 IPv6 网络通信。</p>
<p>双协议栈主机在与 IPv6 主机通信时采用 IPv6 地址，而在与 IPv4 主机通信时采用 IPv4 地址，双协议栈主机使用应用层的域名系统（DNS）获知目的主机采用的是哪种地址。</p>
<p>若 DNS 返回的是 IPv4 地址，则双协议的源主机就使用 IPv4 地址。若 DNS 返回的是 IPv6 地址，则双协议栈的源主机就使用 IPv6 地址。</p>
<p><img src="./assets/374.png" alt/></p>
</li>
<li>
<p><strong>隧道技术</strong></p>
<p>指在 IPv6 数据报要进入 IPv4 网络时，把整个 IPv6 数据报封装成 IPv4 数据报的数据部分，使原来的 IPv6 数据报就好像在 IPv4 网络的隧道中传输。当 IPv4 数据报离开 IPv4 网络时，再将其数据部分交给主机的 IPv6 协议。</p>
<p><img src="./assets/375.png" alt/></p>
</li>
</ol></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>关系图谱</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class aria-controls="toc-content" aria-expanded="true"><h3>目录</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content" class><ul class="overflow"><li class="depth-0"><a href="#网络层概述" data-for="网络层概述">网络层概述</a></li><li class="depth-1"><a href="#冲突域" data-for="冲突域">冲突域</a></li><li class="depth-1"><a href="#广播域" data-for="广播域">广播域</a></li><li class="depth-1"><a href="#路由与转发" data-for="路由与转发">路由与转发</a></li><li class="depth-1"><a href="#路由器" data-for="路由器">路由器</a></li><li class="depth-1"><a href="#网络层的服务" data-for="网络层的服务">网络层的服务</a></li><li class="depth-2"><a href="#分组交换-虚电路" data-for="分组交换-虚电路">分组交换-虚电路</a></li><li class="depth-2"><a href="#分组交换-数据报" data-for="分组交换-数据报">分组交换-数据报</a></li><li class="depth-2"><a href="#比较" data-for="比较">比较</a></li><li class="depth-1"><a href="#异构网络互连" data-for="异构网络互连">异构网络互连</a></li><li class="depth-1"><a href="#软件定义网络sdn" data-for="软件定义网络sdn">软件定义网络(SDN)</a></li><li class="depth-0"><a href="#ipv4" data-for="ipv4">IPV4</a></li><li class="depth-1"><a href="#ipv4-地址" data-for="ipv4-地址">IPv4 地址</a></li><li class="depth-2"><a href="#表示方法" data-for="表示方法">表示方法</a></li><li class="depth-2"><a href="#分类编址" data-for="分类编址">分类编址</a></li><li class="depth-2"><a href="#划分子网编址" data-for="划分子网编址">划分子网编址</a></li><li class="depth-2"><a href="#无分类编址-cidr" data-for="无分类编址-cidr">无分类编址 CIDR</a></li><li class="depth-2"><a href="#子网划分应用举例" data-for="子网划分应用举例">子网划分应用举例</a></li><li class="depth-1"><a href="#ipv4-数据报" data-for="ipv4-数据报">IPv4 数据报</a></li><li class="depth-2"><a href="#格式" data-for="格式">格式</a></li><li class="depth-2"><a href="#分片" data-for="分片">分片</a></li><li class="depth-2"><a href="#发送" data-for="发送">发送</a></li><li class="depth-2"><a href="#转发" data-for="转发">转发</a></li><li class="depth-1"><a href="#网络地址转换nat" data-for="网络地址转换nat">网络地址转换(NAT)</a></li><li class="depth-2"><a href="#基本的-nat-方法" data-for="基本的-nat-方法">基本的 NAT 方法</a></li><li class="depth-2"><a href="#网络地址与端口号转换方法napt" data-for="网络地址与端口号转换方法napt">网络地址与端口号转换方法(NAPT)</a></li><li class="depth-2"><a href="#特点" data-for="特点">特点</a></li><li class="depth-1"><a href="#地址解析协议arp" data-for="地址解析协议arp">地址解析协议(ARP)</a></li><li class="depth-2"><a href="#ip-地址与-mac-地址" data-for="ip-地址与-mac-地址">IP 地址与 MAC 地址</a></li><li class="depth-2"><a href="#地址解析协议" data-for="地址解析协议">地址解析协议</a></li><li class="depth-1"><a href="#网际控制报文协议icmp" data-for="网际控制报文协议icmp">网际控制报文协议(ICMP)</a></li><li class="depth-2"><a href="#差错报告报文" data-for="差错报告报文">差错报告报文</a></li><li class="depth-2"><a href="#询问报文" data-for="询问报文">询问报文</a></li><li class="depth-2"><a href="#icmp-应用" data-for="icmp-应用">ICMP 应用</a></li><li class="depth-0"><a href="#路由算法" data-for="路由算法">路由算法</a></li><li class="depth-1"><a href="#静态路由与动态路由" data-for="静态路由与动态路由">静态路由与动态路由</a></li><li class="depth-1"><a href="#静态路由配置" data-for="静态路由配置">静态路由配置</a></li><li class="depth-2"><a href="#特殊路由" data-for="特殊路由">特殊路由</a></li><li class="depth-1"><a href="#动态路由算法" data-for="动态路由算法">动态路由算法</a></li><li class="depth-2"><a href="#距离-向量路由算法" data-for="距离-向量路由算法">距离-向量路由算法</a></li><li class="depth-2"><a href="#链路状态路由算法" data-for="链路状态路由算法">链路状态路由算法</a></li><li class="depth-0"><a href="#路由选择协议" data-for="路由选择协议">路由选择协议</a></li><li class="depth-1"><a href="#内部网关协议" data-for="内部网关协议">内部网关协议</a></li><li class="depth-2"><a href="#路由信息协议rip" data-for="路由信息协议rip">路由信息协议(RIP)</a></li><li class="depth-2"><a href="#开放最短路径优先协议ospf" data-for="开放最短路径优先协议ospf">开放最短路径优先协议(OSPF)</a></li><li class="depth-1"><a href="#外部网关协议" data-for="外部网关协议">外部网关协议</a></li><li class="depth-2"><a href="#边界网关协议bgp" data-for="边界网关协议bgp">边界网关协议(BGP)</a></li><li class="depth-1"><a href="#三种路由协议比较" data-for="三种路由协议比较">三种路由协议比较</a></li><li class="depth-0"><a href="#ip-多播" data-for="ip-多播">IP 多播</a></li><li class="depth-1"><a href="#概念" data-for="概念">概念</a></li><li class="depth-1"><a href="#多播地址" data-for="多播地址">多播地址</a></li><li class="depth-1"><a href="#硬件多播" data-for="硬件多播">硬件多播</a></li><li class="depth-1"><a href="#网际组管理协议igmp" data-for="网际组管理协议igmp">网际组管理协议(IGMP)</a></li><li class="depth-1"><a href="#多播路由选择协议" data-for="多播路由选择协议">多播路由选择协议</a></li><li class="depth-0"><a href="#移动-ip" data-for="移动-ip">移动 IP</a></li><li class="depth-0"><a href="#ipv6" data-for="ipv6">IPV6</a></li><li class="depth-1"><a href="#特点-1" data-for="特点-1">特点</a></li><li class="depth-1"><a href="#ipv6-数据报" data-for="ipv6-数据报">IPV6 数据报</a></li><li class="depth-1"><a href="#ipv6-地址" data-for="ipv6-地址">IPV6 地址</a></li><li class="depth-2"><a href="#表示方法-1" data-for="表示方法-1">表示方法</a></li><li class="depth-2"><a href="#分类" data-for="分类">分类</a></li><li class="depth-1"><a href="#ipv4-向-ipv6-过渡" data-for="ipv4-向-ipv6-过渡">IPv4 向 IPv6 过渡</a></li></ul></div></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> © 2025</p><ul><li><a href="https://github.com/KISGP">GitHub</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="../../postscript.js" type="module"></script></html>